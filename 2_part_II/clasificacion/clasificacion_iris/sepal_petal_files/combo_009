YUI.add("flickr-stats-photo-daily-views-fetcher",(function(e,s){"use strict";e.namespace("ModelFetchers")["flickr-stats-photo-daily-views"]={run:function(t,a){var o=this;return new e.FlickrPromise({apiResponse:a.callAPI("flickr.stats.photo.getGraphData",this._processParams(t)),modelRegistry:a.getModelRegistry("stats-photo-daily-views-models")}).then((function(e){return o._processResponse(e,t)}),e.FetcherErrorLogger(s))},_processResponse:function(s,t){var a,o,i,r,n,d,l=s.apiResponse.stats.graphdata,c=s.modelRegistry,p={},m={};return d={views:0,favs:0,comments:0},a={id:t.id},l&&(p=l,Object.keys(l).forEach((function(e,s){p[e].burp||p[e].nodot?delete p[e]:(i?(i>e&&(i=e),n<e&&(n=e)):(i=e,n=e),p[e].views||(p[e].views=0),p[e].comments||(p[e].comments=0),p[e].favs||(p[e].favs=0),p[e].views=parseInt(p[e].views,10),p[e].favs=parseInt(p[e].favs,10),p[e].comments=parseInt(p[e].comments,10),d.views+=p[e].views,d.favs+=p[e].favs,d.comments+=p[e].comments)}))),a.days=p,a.oldestDate=i,a.newestDate=n,a.totals=d,c.exists(a.id)?(m=c.getValue("days"),a.days=e.merge(a.days,m),o=c.getValue("oldestDate"),i>o&&(a.oldestDate=o),r=c.getValue("newestDate"),n>r&&(a.newestDate=r),a.totals+=e.merge(a.totals,c.getValue("totals")),c.setValues(a.id,a)):c.add(a),a},_processParams:function(e){return{id:e.id,photo_id:e.photoId}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-photo-daily-views-models"]});YUI.add("stats-photo-daily-views-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-stats-photo-daily-views"].run(e,this.appContext)}},attributes:{days:{},oldestDate:{},newestDate:{},totals:{}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-photo-daily-views-fetcher"]});YUI.add("flickr-stats-referrer-domains-fetcher",(function(e,r){"use strict";var t=require("hermes-core/flog")(r),s={flickr:"flickr","search engine":"search",social:"social",yahoo:"search",google:"search",bing:"search",twitter:"social",facebook:"social",pinterest:"social",tumblr:"social","flickr embedr":"flickr embedr"};e.namespace("ModelFetchers")["flickr-stats-referrer-domains"]={run:function(r,s){var o=this;return new e.FlickrPromise({apiResponse:s.callAPI("flickr.stats.getReferrerCategoriesForDate",this._processParams(r)),modelRegistry:s.getModelRegistry("stats-referrer-domains-models")}).then((function(e){return o._processResponse(e,r)}),(function(e){if(2===e.code)return t.error({err:e,id:r.id,date:r.date}),s.getModelRegistry("stats-referrer-domains-models").then((function(e){e.addOrUpdate({id:r.id,missingData:!0})}));throw e}))},_processResponse:function(e,r){var t,o,i,a=e.apiResponse,n=e.modelRegistry,c={},d={},l=0,f=a.stat;if(t={id:r.id},delete a.stat,i=Object.keys(a),a.stat=f,0===i.length)throw(o=new Error("[flickr-stats-referrer-domains-fetcher] api returned ok but did not contain the data needed")).fatal=!0,o;return i.forEach((function(e,r){var t,o=s[e.toLowerCase()],i=a[e];o||(o="other"),c[o]||(c[o]={}),d[o]||(d[o]=0),t=i.viewcount,delete i.viewcount,c[o]=i,d[o]+=t,l+=t})),t.referrers=c,t.totals=d,t.total=l,n.addOrUpdate(t),t},_processParams:function(e){return{id:e.id,date:e.date||"",photo_id:e.photoId||""}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-referrer-domains-models"]});YUI.add("stats-referrer-domains-models",(function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-stats-referrer-domains"].run(r,this.appContext)}},attributes:{referrers:{defaultValue:{}},totals:{defaultValue:{}},total:{defaultValue:0},missingData:{defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-referrer-domains-fetcher"]});YUI.add("stats-photo-view",(function(e){var t=500;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.statsHelper=new e.StatsHelper,this.photoId=t.photoId,this.dateString=t.dateString,this.prettyDateString=t.prettyDateString||t.dateString,this.realtimeDateString=t.realtimeDateString||t.dateString,this.isOwner=t.isOwner,this.nsid=t.nsid,this.isPro=!1,this.pickers={},this.tooltip,this.dateIntl={previousMonth:this.intlMessage({intlName:"pika-day.PREVIOUS_MONTH"}),nextMonth:this.intlMessage({intlName:"pika-day.NEXT_MONTH"})},this.dateIntl.weekdays=[this.intlMessage({intlName:"pika-day.SUNDAY"}),this.intlMessage({intlName:"pika-day.MONDAY"}),this.intlMessage({intlName:"pika-day.TUESDAY"}),this.intlMessage({intlName:"pika-day.WEDNESDAY"}),this.intlMessage({intlName:"pika-day.THURSDAY"}),this.intlMessage({intlName:"pika-day.FRIDAY"}),this.intlMessage({intlName:"pika-day.SATURDAY"})],this.dateIntl.weekdaysShort=[this.intlMessage({intlName:"pika-day.SUNDAY_SHORT"}),this.intlMessage({intlName:"pika-day.MONDAY_SHORT"}),this.intlMessage({intlName:"pika-day.TUESDAY_SHORT"}),this.intlMessage({intlName:"pika-day.WEDNESDAY_SHORT"}),this.intlMessage({intlName:"pika-day.THURSDAY_SHORT"}),this.intlMessage({intlName:"pika-day.FRIDAY_SHORT"}),this.intlMessage({intlName:"pika-day.SATURDAY_SHORT"})],this.dateIntl.months=[this.intlMessage({intlName:"pika-day.JANUARY"}),this.intlMessage({intlName:"pika-day.FEBRUARY"}),this.intlMessage({intlName:"pika-day.MARCH"}),this.intlMessage({intlName:"pika-day.APRIL"}),this.intlMessage({intlName:"pika-day.MAY"}),this.intlMessage({intlName:"pika-day.JUNE"}),this.intlMessage({intlName:"pika-day.JULY"}),this.intlMessage({intlName:"pika-day.AUGUST"}),this.intlMessage({intlName:"pika-day.SEPTEMBER"}),this.intlMessage({intlName:"pika-day.OCTOBER"}),this.intlMessage({intlName:"pika-day.NOVEMBER"}),this.intlMessage({intlName:"pika-day.DECEMBER"})],this.viewClass="",""===this.get("container").get("innerHTML")&&this.setContainerHTML('<div class="balls"></div>'),this},loadState:function(){if(!this.isOwner)return e.Promise.resolve();var t,r,a,i,n,s,o=this,l={};return this.isOwner?this.appContext.getModel("person-models",this.nsid).then((function(d){return o.isPro=d.getValue("isPro"),o.isPro?(t=e.moment().format("X"),r=new e.TimezoneHelper(o.appContext,t,"+00:00"),o.dateString||(o.dateString=r.toFormat("YYYY-MM-DD"),o.prettyDateString=r.toFormat("MMM D, YYYY"),o.realtimeDateString=o.dateString),a={date:o.dateString,photoId:o.photoId},i={id:o.statsHelper.getIdFromParams(a)},l.dailyViewsModel=o.appContext.getModel("stats-photo-daily-views-models",i,a),n={date:o.dateString,photoId:o.photoId},s={id:o.statsHelper.getIdFromParams(n)},l.referrerDomainsModel=o.appContext.getModel("stats-referrer-domains-models",s,n),l.photoModel=o.appContext.getModel("photo-models",o.photoId),l.photoStatsModel=o.appContext.getModel("photo-stats-models",o.photoId),new e.FlickrPromise(l).then((function(e){o.dailyViewsModel=e.dailyViewsModel,o.referrerDomainsModel=e.referrerDomainsModel,o.photoModel=e.photoModel,o.photoModel.stats=e.photoStatsModel}),(function(e){console.log(e)}))):e.Promise.resolve()})):e.Promise.resolve()},loadNewDateData:function(t){var r,a,i=this,n={};return a={date:t,photoId:i.photoId},r={id:this.statsHelper.getIdFromParams(a)},n.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",r,a),new e.FlickrPromise(n).then((function(e){t===i.dateString&&(i.referrerDomainsModel=e.referrerDomainsModel,i.refreshContent())}),(function(e){console.log(e)}))},refreshContent:function(){var e,r=t,a=this.get("container");this.updateCurrentDatePoint(this.dateString,document.querySelector("circle.selectedPoint").getAttribute("key")),this.createReferrersGraphs(),(e=a.one(".source-breakdown-right .sources-breakdown"))&&(r=e.get("clientHeight")),a.setStyles({height:Math.max(t,r+60)+"px"})},buildContainer:function(){var e=!1;return this.isPro&&this.isOwner&&(e=this.referrerDomainsModel.getValue("total")>0),this.setContainerWithTemplate("stats-photo",{hasStats:this.isPro,hasReferrers:e,prettyDateString:this.dateString===this.realtimeDateString?this.intlMessage({intlName:"stats.TODAY"}):this.prettyDateString,photoUrl:this.photoModel.getSizeToFit({width:100,height:100}).url,url:this.photoModel.getValue("url"),title:this.photoModel.getValue("title"),basicStats:this.photoModel.getValue("engagement").toJSON(),datePosted:this.photoModel.stats.getDateObj("datePosted"),actuallyHasSomeStats:this.dailyViewsModel&&this.dailyViewsModel.getValue("totals").views>0&&this.isPro}),this},activate:function(){if(!this.isOwner||!this.isPro||!this.dailyViewsModel)return this;var t=this,r=this.get("container"),a={},i=r.all(".date-picker").getDOMNodes(),n=this.dailyViewsModel.getValue("oldestDate"),s=this.dailyViewsModel.getValue("newestDate");return this.dailyViewsModel.getValue("totals").views>0&&this.isPro&&e.use("d3",(function(){r.addClass("hasStats"),t.viewClass="."+r.getAttribute("class").replace(/\s/g,"."),t.createMainGraph(),a={i18n:t.dateIntl,position:"bottom right",reposition:!1,format:"YYYY-MM-DD",minDate:e.moment(n).toDate(),maxDate:e.moment(s).toDate(),yearRange:[parseInt(n.substring(0,4),10),parseInt(s.substring(0,4),10)],defaultDate:e.moment(t.dateString).toDate(),setDefaultDate:!0,onSelect:function(e){t.pickaNewDate(e,this.config().theme)},onOpen:function(){t.el&&(t.el.className+=" stats-photo")}},e.use("pika-day",(function(e){i.forEach((function(r,i){t.pickers[i]=new e.Pikaday(e.merge(a,{field:r,theme:"picker-"+i}))}))})),t.createReferrersGraphs(),t.registerEventHandler(r.all(".photo-stats-nav-link").on("click",t.handleNavItemClick,t)),t.registerEventHandler(r.one(".source-breakdown-left").on("click",t.handleSourceBreakdownClick,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("click",t.handleSourceBreakdownClick,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("mouseover",t.handleSourceBreakdownListItemMouseover,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("mouseout",t.handleSourceBreakdownListItemMouseout,t))})),this},handleNavItemClick:function(r){var a,i=r.target,n=i.getData("link"),s=this.get("container"),o=t;i.hasClass("selected")||(s.all(".photo-stats-nav-link").removeClass("selected"),i.addClass("selected"),s.one(".photo-stats-sections").getDOMNode().setAttribute("data-showing",n),"sources"===n?((a=s.one(".source-breakdown-right .sources-breakdown"))&&(o=a.get("clientHeight"),e.config.win.innerWidth<=700&&(o=o+140+100+70-60)),s.setStyles({height:Math.max(t,o+60)+"px"})):s.setStyles({height:"500px"}))},handleSourceBreakdownClick:function(r){var a,i,n,s,o,l,d,c,h,u,g=r.target,f=g.ancestor(),p=g.getDOMNode(),v=g.getData(),w=this.get("container"),m=w.one(".sources-pie-chart"),y=w.one(".source-breakdown-right"),k=t;if("path"===p.tagName.toLowerCase())h=this.statsHelper.whichChild(p),u="overall"===f.getDOMNode().classList[0]?y.all(".referrer-row"):y.all(".referrer-row-breakdown-row"),"other"!==f.getAttribute("referrerkey")&&"flickr embedr"!==f.getAttribute("referrerkey")&&u.getDOMNodes()[h].querySelector(".header").click();else if(g.hasClass("header")){if(v=f.getData(),(d={margin:{top:0,right:0,bottom:0,left:0}}).width=m.get("clientWidth")-d.margin.left-d.margin.right,d.height=m.get("clientHeight")-d.margin.top-d.margin.bottom,s=(n=this.referrerDomainsModel).getValue("referrers"),o=n.getValue("totals"),l=Object.keys(o),this.statsHelper.moveToFrontOfArray(l,"flickr"),w.all(".referrer-row-breakdown-row-breakdown-row.shown").replaceClass("shown","not-shown"),w.all(".referrer-row-breakdown-row-breakdown .show-whole-list").removeClass("no-show"),v.category){if(c=y.getData("showing"),a=v.category,y.all(".referrer-row").removeClass("selected"),e.AttributeHelpers.coerceBoolean(v.isempty))return"NOPE"!==c&&this.createOverallPieChart(d,l,o,null,null,!1),e.d3.selectAll(this.viewClass+" .sources-pie-chart .first-level").remove(),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.all(".referrer-row-breakdown-row").removeClass("selected"),y.setData("showing","NOPE"),void y.setData("subshowing","NOPE");c!==a?(f.addClass("selected"),y.setData("showing",a),w.one(".first-level")&&(e.d3.selectAll(this.viewClass+" .sources-pie-chart .first-level").remove(),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.all(".referrer-row-breakdown-row").removeClass("selected"),y.setData("subshowing","NOPE")),this.createOverallPieChart(d,l,o,!0),"other"===a||"flickr embedr"===a?this.createPieChart("first-level",d,Object.keys(s[a].items),s[a].items,a):this.createPieChart("first-level",d,Object.keys(s[a]),s[a],a)):(y.setData("showing","NOPE"),this.createOverallPieChart(d,l,o,null,null,!1),"other"===a||"flickr embedr"===a?this.createPieChart("first-level",d,Object.keys(s[a].items),s[a].items,a,null,!0):this.createPieChart("first-level",d,Object.keys(s[a]),s[a],a,null,!0),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.setData("subshowing","NOPE"))}else if(v.referrer){if(c=y.getData("subshowing"),a=v.referrer,i=v.parentcategory,y.all(".referrer-row-breakdown-row").removeClass("selected"),e.AttributeHelpers.coerceBoolean(v.isempty))return y.setData("subshowing","NOPE"),void("NOPE"!==c&&(this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeOpen"),this.createPieChart("second-level",d,Object.keys(s[i][c].items),s[i][c].items,c,i,!0)));c!==a?(f.addClass("selected"),y.setData("subshowing",a),w.one(".first-level")&&e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeClose"),this.createPieChart("second-level",d,Object.keys(s[i][a].items),s[i][a].items,a,i)):(y.setData("subshowing","NOPE"),this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeOpen"),this.createPieChart("second-level",d,Object.keys(s[i][a].items),s[i][a].items,a,i,!0))}k=w.one(".source-breakdown-right .sources-breakdown").get("clientHeight"),e.config.win.innerWidth<=700&&(k=k+140+100+70-60),w.setStyles({height:Math.max(t,k+60)+"px"})}else g.hasClass("show-whole-list")&&(w.all(".referrer-row-breakdown-row-breakdown-row.not-shown").replaceClass("not-shown","shown"),w.all(".referrer-row-breakdown-row-breakdown .show-whole-list").addClass("no-show"))},handleSourceBreakdownListItemMouseover:function(e){var t,r,a=e.target,i=a.ancestor(),n=this.get("container");i.hasClass("referrer-row")?(t=this.statsHelper.whichChild(i.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .overall path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class","")):i.hasClass("referrer-row-breakdown-row")?(t=this.statsHelper.whichChild(i.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .first-level path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class","")):a.hasClass("referrer-row-breakdown-row-breakdown-row")&&(t=this.statsHelper.whichChild(a.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .second-level path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class",""))},handleSourceBreakdownListItemMouseout:function(e){var t=e.target;"pie"!==t.getDOMNode().getAttribute("class")&&"path"!==t.getDOMNode().tagName&&this.get("container").all(".source-breakdown-left .pie-chart path").setAttribute("class","")},pickaNewDate:function(t,r){var a,i,n=new e.TimezoneHelper(this.appContext,t.getTime()/1e3+Math.abs(60*t.getTimezoneOffset()),"+00:00");for(a in this.dateString=n.toFormat("YYYY-MM-DD"),this.prettyDateString=n.toFormat("MMM D, YYYY"),this.pickers)i=this.dateString===this.realtimeDateString?this.intlMessage({intlName:"stats.TODAY"}):this.prettyDateString,i+=" <span></span>",this.pickers[a]._o.field.innerHTML=i,a!==r&&this.pickers[a].setMoment(n.momentObject,!0);this.loadNewDateData(this.dateString)},createMainGraph:function(){var t,r,a,i,n,s,o=this.dailyViewsModel,l=o.getValue("days"),d=Object.keys(l),c=o.getValue("newestDate"),h=e.d3.time.format("%Y-%m-%d").parse,u=this,g=this.get("container"),f=".daily-views-graph",p=g.one(f),v=[],w="linear";this.daysKeys=d,(r={margin:{top:15,right:15,bottom:90,left:60}}).width=p.get("clientWidth")-r.margin.left-r.margin.right,r.height=p.get("clientHeight")-r.margin.top-r.margin.bottom,u.createYStuff=function(t){var a={yMin:0};return a.yMax=e.d3.max(d,(function(e,r){return+l[e][t]})),a.yMax=Math.ceil(1.2*a.yMax),a.yMaxLength=a.yMax.toString().length,a.yAxisDivisor=Math.pow(10,Math.max(0,a.yMaxLength-2)),a.yMax=Math.ceil(.2*a.yMax/a.yAxisDivisor)*a.yAxisDivisor*5,a.yAxisValues=[0,Math.ceil(.2*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.4*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.6*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.8*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(a.yMax/a.yAxisDivisor)*a.yAxisDivisor],a.y=e.d3.scale.linear().range([r.height,0]).domain([a.yMin,a.yMax]),a.yAxis=e.d3.svg.axis().scale(a.y).orient("left").tickSubdivide(!1).tickValues(a.yAxisValues).tickFormat((function(e,t){var r=e;return 0===t&&(r=""),r})),a},s={views:u.createYStuff("views"),favs:u.createYStuff("favs"),comments:u.createYStuff("comments")},d.forEach((function(e,t){v.push(h(e))})),i=e.d3.extent(d,(function(e,t){return h(e)})),a=e.d3.time.scale().range([0,r.width]).domain(i),n=e.d3.svg.axis().scale(a).orient("bottom").tickValues(v).tickFormat((function(t,r){var a="";return r%2==0&&(a=parseInt(e.d3.time.format("%e")(t),10),0!==r&&1!==a&&2!==a||(a+=" "+e.d3.time.format("%b")(t))),a})),(t=e.d3.select(u.viewClass+" "+f).append("svg").attr("class","main-graph").attr("width",r.width+r.margin.left+r.margin.right).attr("height",r.height+r.margin.top+r.margin.bottom).on("mouseleave",(function(){e.d3.select(u.viewClass+" .selectedPoint").attr("cx",-100).attr("cy",-100)}))).append("defs").append("linearGradient").attr("id","photoDailyViewsViews").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").selectAll("stop").data([{offset:"0%",color:"#24d9d7"},{offset:"100%",color:"#00aaff"}]).enter().append("stop").attr("offset",(function(e){return e.offset})).attr("stop-color",(function(e){return e.color})),t.append("g").attr("class","weekends").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("width",r.width).attr("height",r.height).selectAll("rect").data(d).enter().append("rect").attr("class",(function(e,t){var r=h(e).getDay(),a="";return 0!==r&&6!==r||(a="weekend"),a})).attr("y",0).attr("x",(function(e,t){var i=a(h(e));return t>0&&(i-=r.width/d.length/2),i})).attr("height",r.height).attr("width",(function(e,t){var a=r.width/d.length;return 0!==t&&t!==d.length-1||(a/=2),a})),t.append("g").attr("class","gridlines").attr("transform","translate(0, "+r.margin.top+")").selectAll("line").data(s.views.yAxisValues).enter().append("line").attr("x1",0).attr("x2",r.width+r.margin.left+r.margin.right).attr("y1",(function(e){return s.views.y(e)})).attr("y2",(function(e){return s.views.y(e)})),u.createYAxis=function(t,a){var i=!1;(i=e.d3.selectAll(u.viewClass+" .y.axis"))&&i.remove(),t.insert("g",".x.axis").attr("class","y axis").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").call(s[a].yAxis).selectAll("text").attr("x","-10").attr("y","12")},u.createYAxis(t,"views"),t.append("g").attr("class","x axis").attr("transform","translate("+r.margin.left+", "+(r.height+r.margin.top)+")").call(n).selectAll("text").attr("y","10").call((function(t){t.each((function(){for(var t,r=e.d3.select(this),a=r.text().split(/\s+/).reverse(),i=[],n=0,s=r.attr("y"),o=parseFloat(r.attr("dy")),l=r.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",o+"em"),d=a.length;t=a.pop();)i.push(t),l.text(i.join(" ")),d>1&&(i.pop(),l.text(i.join(" ")),i=[t],""!==t&&" "!==t&&(l=r.append("tspan").attr("x",0).attr("y",s).attr("dy",1.1*n+++o+"em").text(t)))}))})),u.createFlatLine=function(){return e.d3.svg.line().x((function(e){return a(h(e))})).y((function(e){return s.views.y(0)}))},u.createLine=function(t){return e.d3.svg.line().interpolate(w).x((function(e){return a(h(e))})).y((function(e){return s[t].y(l[e][t])}))},u.createArea=function(t){return e.d3.svg.area().interpolate(w).x((function(e){return a(h(e))})).y0(r.height).y1((function(e){return s[t].y(l[e][t])}))},t.append("path").attr("class","main-line views").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("d",u.createFlatLine()(d)).attr("stroke","url(#photoDailyViewsViews)").transition().delay(500).duration(500).attr("d",u.createLine("views")(d)),u.updatePoint=function(t,i,n,o){var d=e.d3.select(u.viewClass+" "+t),c=d.attr("cx"),g=d.attr("cy"),f=a(h(i))+r.margin.left,p=s[n].y(l[i][n])+r.margin.top;return o?d.transition().duration(500).attr("cx",f).attr("cy",p).attr("date",i).attr("key",n):d.attr("cx",f).attr("cy",p).attr("date",i).attr("key",n),{point:d,oldXY:[c,g],newXY:[f,p]}},u.updateCurrentDatePoint=function(e,t,r){u.updatePoint(".currentDatePoint",e,t,r)},u.updateSelectedPoint=function(t,r,a){u.updatePoint(".selectedPoint",t,r,a);var i,n,s={};return i={date:t,photoId:u.photoId},n={id:u.statsHelper.getIdFromParams(i)},s.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",n,i),new e.FlickrPromise(s).then((function(e){}),(function(e){console.log(e)}))},u.createVoronoi=function(i){var n=!1;(n=e.d3.selectAll(u.viewClass+" g.voronoi"))&&n.remove(),t.insert("g",".selectedPoint").attr("class","voronoi").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("width",r.width+r.width/d.length).attr("height",r.height).selectAll("rect").data(d).enter().append("rect").attr("y",0).attr("x",(function(e,t){var i=a(h(e));return i-=r.width/d.length/2})).attr("height",r.height).attr("width",(function(e,t){return r.width/d.length})).on("mouseenter",(function(e,t){u.updateSelectedPoint(d[t],i)}))},t.append("circle").attr("class","currentDatePoint").attr("date",c).attr("key","views").attr("r",7).attr("cx",(function(e,t){return c===u.dateString?a(h(c))+r.margin.left:a(h(u.dateString))+r.margin.left})).attr("cy",s.views.y(0)+r.margin.top).transition().delay(500).duration(500).attr("cy",(function(e,t){return c===u.dateString?s.views.y(l[c].views)+r.margin.top:s.views.y(l[u.dateString].views)+r.margin.top})),t.append("circle").attr("class","selectedPoint").attr("cx",-100).attr("cy",-100).attr("r",4).attr("date",c).attr("key","views").on("click",(function(){u.pickaNewDate(new Date(this.getAttribute("date")))})).on("mouseenter",(function(t,r){var a,i=this.getAttribute("date"),n=l[i],s=new Date(i),o=new e.TimezoneHelper(u.appContext,s.getTime()/1e3+Math.abs(60*s.getTimezoneOffset()),"+00:00").toFormat("MMMM D"),d=150,c=n.views;n.favs>c&&(c=n.favs),n.comments>c&&(c=n.comments),d+=20*(c.toString().length-1),a='<div class="date">'+o+'</div><div class="stats"><div class="stat"><i class="icon" data-type="views"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.views})+'</div><div class="stat"><i class="icon" data-type="faves"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.favs})+'</div><div class="stat"><i class="icon" data-type="comments"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.comments})+"</div></div>",u.tooltip?u.tooltip.updateHTMLMessage(a):(u.tooltip=new e.Views.FluidDroparound({appContext:u.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showDropArrow:!0,preferTop:!0,preferLeft:!0,width:d,height:60,classList:"photo-daily-stats-tooltip over-modal",anchorElement:g.one(".selectedPoint"),hideModalOverlay:!0,invisibleOverlay:!0,htmlMessage:a,anchorOffsetVertical:10,closeOnScroll:!0}),u.tooltip.show())})).on("mouseleave",(function(e){u.tooltip&&(u.tooltip.close(),u.tooltip=void 0)})),u.createVoronoi("views")},createReferrersGraphs:function(){var e,t,r,a=this,i=this.referrerDomainsModel,n=i.getValue("referrers"),s=i.getValue("total"),o=i.getValue("totals"),l=this.get("container"),d=l.one(".sources-pie-chart"),c=l.one(".source-breakdown-left"),h=l.one(".source-breakdown-right"),u=d.one(".overall"),g="";h.setData("showing","NOPE"),h.setData("subshowing","NOPE"),0===parseInt(s,10)?(c.addClass("no-results"),h.addClass("no-results")):(c.removeClass("no-results"),h.removeClass("no-results"),e=Object.keys(n),this.statsHelper.moveToFrontOfArray(e,"flickr"),this.statsHelper.moveToEndOfArray(e,"other"),t=Object.keys(o),this.statsHelper.moveToFrontOfArray(t,"flickr"),this.statsHelper.moveToEndOfArray(t,"other"),(r={margin:{top:0,right:0,bottom:0,left:0}}).width=d.get("clientWidth")-r.margin.left-r.margin.right,r.height=d.get("clientHeight")-r.margin.top-r.margin.bottom,this.set("outerRadius",r.height/2),u?a.createOverallPieChart(r,t,o,!1,!0):a.createOverallPieChart(r,t,o),g='<div class="referrer-rows">',t.forEach((function(e,t){"search"===e&&0===o[e]?g+='<div class="referrer-row" data-category="'+e+'" data-isempty="true">':g+='<div class="referrer-row" data-category="'+e+'" data-isempty="false">',g+='<div class="header">',"search"===e&&0===o[e]?g+='<div><span class="dot"></span>'+e+"</div>":g+='<div><span class="dot"></span>'+e+'<span class="caret"></span></div>',g+="<div>"+a.intlMessage({intlName:"stats.NUMBER",num:o[e]})+"</div>",g+="<div>"+Math.round(o[e]/s*100)+"%</div>",g+="</div>",g+="</div>"})),g+="</div>",h.one(".sources-breakdown-list").empty().append(g),e.forEach((function(e,t){var r,i,s,l="";"other"===e||"flickr embedr"===e?(r=n[e].items,i=Object.keys(r),void 0!==(s=o[e]).viewcount&&(s=s.viewcount),l='<div class="referrer-row-breakdown" data-index="'+t+'" data-group="'+e+'">'+a.createOtherReferrerListRowsHTML(i,r,s,e)+"</div>"):(r=n[e],i=Object.keys(r),s=o[e],l='<div class="referrer-row-breakdown" data-index="'+t+'" data-group="'+e+'">'+a.createReferrerListRowsHTML(i,r,s,e)+"</div>"),h.one('.referrer-row[data-category="'+e+'"]').append(l)})))},createOverallPieChart:function(t,r,a,i,n){i||(i=!1);var s,o,l,d,c=this.get("outerRadius"),h=this.get("innerRadius"),u=501,g=".sources-pie-chart",f=this.get("container").one(g).one("svg .overall"),p=0;r.forEach((function(e){var t=a[e];void 0!==t.viewcount&&(t=t.viewcount),p+=t})),e.d3.scale.linear().domain([1,r.length]).range(["#00aaff","#18297f"]),o=e.d3.svg.arc().innerRadius(h).outerRadius(c),n&&f&&(e.d3.select(this.viewClass+" "+g+" svg").remove(),f=!1),f?i?(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),d=(s=e.d3.select(this.viewClass+" "+g+" svg .overall")).datum(r).selectAll("path").call((function(t){t.transition().delay((function(e,t){var i=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==a[r[s]].viewcount?n+=a[r[s]].viewcount:n+=a[r[s]];i=n/p*u}return i})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=r(e),o(t)}}))}))):(l=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),(d=(s=e.d3.select(this.viewClass+" "+g+" svg .overall")).selectAll("path")).data().map((function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle})),d.call((function(t){t.transition().delay((function(e,t){var i=0,n=0;for(n=t+1;n<r.length;n++)void 0!==a[r[n]].viewcount?i+=a[r[n]].viewcount:i+=a[r[n]];return i/p*u})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=r(e),o(t)}}))})),e.d3.select(this.viewClass+" "+g+" svg text").text(p)):(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),d=(s=e.d3.select(this.viewClass+" "+g).append("svg").attr("class","pie").attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom).append("g").attr("class","overall").attr("height",t.height+t.margin.top+t.margin.bottom).attr("width",2*c).attr("transform","translate("+t.width/2+", "+c+")")).datum(r).selectAll("path").data(l).enter().append("path").attr("data-source",(function(e){return e.data})).on("mouseenter",function(e,t){var r,a,i=this.get("container");r=i.all(".source-breakdown-right .referrer-row"),a=i.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),r.getDOMNodes()[t].setAttribute("class",r.getDOMNodes()[t].getAttribute("class")+" temp-selected"),a.setAttribute("class","not-selected"),a.getDOMNodes()[t].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,t){var r,a,i=this.get("container");r=i.all(".source-breakdown-right .referrer-row"),a=i.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),a.setAttribute("class","")}.bind(this)).transition().delay((function(e,t){var i=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==a[r[s]].viewcount?n+=a[r[s]].viewcount:n+=a[r[s]];i=n/p*u}return i})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),o(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})),s.append("text").attr("transform","translate(0, 5)").attr("fill-opacity",0).text(p).transition().delay(250.5).duration(250.5).attr("fill-opacity",1))},createPieChart:function(t,r,a,i,n,s,o){o||(o=!1);var l,d,c,h,u,g=this.get("outerRadius"),f=this.get("innerRadius"),p=501,v=".sources-pie-chart",w=this.get("container").one(v).one("svg ."+t),m=0,y=a.length;return a.forEach((function(e){var t=i[e];void 0!==t.viewcount&&(t=t.viewcount),m+=t})),u=e.d3.scale.linear().domain([1,a.length]).range(["#00aaff","#18297f"]),d=e.d3.svg.arc().innerRadius(f).outerRadius(g),w?!0===o?0===m?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){return 1})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,i=0;for(i=t+1;i<a.length;i++)r+=1;return r/y*p})).duration((function(e,t){return e.value/y*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))}))):(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,n=0;for(n=t+1;n<a.length;n++)void 0!==i[a[n]].viewcount?r+=i[a[n]].viewcount:r+=i[a[n]];return r/m*p})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))}))):"fakeClose"===o?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==i[a[s]].viewcount?n+=i[a[s]].viewcount:n+=i[a[s]];r=n/m*p}return r})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=r(e),d(t)}}))}))):(c=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),(h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).selectAll("path")).data().map((function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle})),h.call((function(t){t.transition().delay((function(e,t){var r=0,n=0;for(n=t+1;n<a.length;n++)void 0!==i[a[n]].viewcount?r+=i[a[n]].viewcount:r+=i[a[n]];return r/m*p})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=r(e),d(t)}}))})),e.d3.select(this.viewClass+" "+v+" svg text").text(m)):(0===m?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){return 1})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg").append("g").attr("class",t).attr("referrerkey",n).attr("parentreferrerkey",s).attr("height",r.height+r.margin.top+r.margin.bottom).attr("width",2*g).attr("transform","translate("+r.width/2+", "+g+")")).datum(a).selectAll("path").data(c).enter().append("path").attr("data-source",(function(e){var t=e.data;return"flickr"!==n&&"other"!==n&&"flickr embedr"!==n||(t=""),t})).attr("fill",(function(e,t){var r="";return("flickr"===n||"other"===n||"flickr embedr"===n||s)&&(r=u(t)),r})).transition().delay((function(e,t){var r=0,a=0,i=0;if(t>0){for(i=t-1;i>=0;--i)a+=1;r=a/y*p}return r})).duration((function(e,t){return e.value/y*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))):(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),
h=(l=e.d3.select(this.viewClass+" "+v+" svg").append("g").attr("class",t).attr("referrerkey",n).attr("parentreferrerkey",s).attr("height",r.height+r.margin.top+r.margin.bottom).attr("width",2*g).attr("transform","translate("+r.width/2+", "+g+")")).datum(a).selectAll("path").data(c).enter().append("path").attr("data-source",(function(e){var t=e.data;return"flickr"!==n&&"other"!==n&&"flickr embedr"!==n||(t=""),t})).attr("fill",(function(e,t){var r="";return("flickr"===n||"other"===n||"flickr embedr"===n||s)&&(r=u(t)),r})).on("mouseenter",function(e,r){var a,i,o,l=this.get("container");s?(a=l.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+s+'"][data-referrer="'+n+'"] .referrer-row-breakdown-row-breakdown-row:not(.not-shown)'),i=l.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path'),a.removeClass("selected"),(o=a.getDOMNodes()[r])&&o.setAttribute("class","referrer-row-breakdown-row-breakdown-row temp-selected")):(a=l.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+n+'"] .referrer-row-breakdown-row'),i=l.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path'),a.removeClass("selected"),a.getDOMNodes()[r].setAttribute("class","referrer-row-breakdown-row temp-selected")),i.setAttribute("class","not-selected"),i.getDOMNodes()[r].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,r){var a,i,o=this.get("container");s?(a=o.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+s+'"][data-referrer="'+n+'"] .referrer-row-breakdown-row-breakdown-row'),i=o.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path')):(a=o.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+n+'"] .referrer-row-breakdown-row'),i=o.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path')),a.removeClass("temp-selected"),i.setAttribute("class","")}.bind(this)).transition().delay((function(e,t){var r=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==i[a[s]].viewcount?n+=i[a[s]].viewcount:n+=i[a[s]];r=n/m*p}return r})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))),e.d3.select(this.viewClass+" "+v+" svg text").text(m)),l},createReferrerBreakdownListRowsHTML:function(t,r,a,i){var n,s,o=this,l="";return n=Object.keys(t),s=e.d3.scale.linear().domain([1,n.length]).range(["#00aaff","#18297f"]),l='<div class="referrer-row-breakdown-row-breakdown">',n.forEach((function(a,i){var n,d,c,h,u=!1,g=t[a].viewcount;n="referrer-row-breakdown-row-breakdown-row",i>=5&&(n+=" not-shown"),"direct"!==(d=e.Escape.html(t[a].displaytext)).toLowerCase()&&"/"!==d||(t[a].platform&&(d=t[a].platform.split(".")[1]),t[a].link&&""!==t[a].link&&"/"!==t[a].link&&(d=t[a].link)),t[a].link&&""!==t[a].link&&"/"!==t[a].link&&(u=!0,c=e.Escape.html(t[a].link)),h=' style="background: '+s(i)+';"',l+=u?'<a class="'+n+'" title="'+d+'" href="'+c+'" target="_blank">':'<div class="'+n+'" title="'+d+'">',l+='<div><span class="dot"'+h+"></span>"+d+"</div>",l+="<div>"+o.intlMessage({intlName:"stats.NUMBER",num:g})+"</div>",l+="<div>"+Math.round(g/r*100)+"%</div>",l+=u?"</a>":"</div>"})),n.length>5&&(l+='<div class="show-whole-list">'+o.intlMessage({intlName:"stats.SHOW_ALL"})+"</div>"),l+="</div>"},createReferrerListRowsHTML:function(t,r,a,i){var n,s="",o=this,l="";return n=e.d3.scale.linear().domain([1,t.length]).range(["#00aaff","#18297f"]),t.forEach((function(e,t){var d=r[e],c=e;"sets"===c.toLowerCase()&&(c="Albums"),void 0!==d.viewcount&&(d=d.viewcount),"flickr"!==i&&"other"!==i&&"flickr embedr"!==i||(l=' style="background: '+n(t)+';"'),s+='<div class="referrer-row-breakdown-row" title="'+c+'" data-parentcategory="'+i+'" data-referrer="'+e+'" data-isempty="'+!r[e].items+'">',s+='<div class="header">',r[e].items?s+='<div><span class="dot"'+l+"></span>"+c+'<span class="caret"></span></div>':s+='<div><span class="dot"'+l+"></span>"+c+"</div>",s+="<div>"+o.intlMessage({intlName:"stats.NUMBER",num:d})+"</div>",s+=a>0?"<div>"+Math.round(d/a*100)+"%</div>":"<div>0%</div>",s+="</div>",r[e].items&&(s+=o.createReferrerBreakdownListRowsHTML(r[e].items,d,i,e)),s+="</div>"})),s},createOtherReferrerListRowsHTML:function(t,r,a,i){var n,s=this,o="";return n=e.d3.scale.linear().domain([1,t.length]).range(["#00aaff","#18297f"]),t.forEach((function(t,l){var d,c,h,u=!1,g=r[t].viewcount;"direct"!==(d=e.Escape.html(r[t].displaytext)).toLowerCase()&&"/"!==d||(r[t].platform&&(d=r[t].platform.split(".")[1]),r[t].link&&""!==r[t].link&&"/"!==r[t].link&&(d=r[t].link)),r[t].link&&""!==r[t].link&&"/"!==r[t].link&&(u=!0,c=e.Escape.html(r[t].link)),h=' style="background: '+n(l)+';"',o+=u?'<a class="referrer-row-breakdown-row" title="'+d+'" href="'+c+'" target="_blank" data-parentcategory="'+i+'">':'<div class="referrer-row-breakdown-row" title="'+d+'" data-parentcategory="'+i+'">',o+='<div class="header">',o+='<div><span class="dot"'+h+"></span>"+d+'<span class="caret"></span></div>',o+="<div>"+s.intlMessage({intlName:"stats.NUMBER",num:g})+"</div>",o+="<div>"+Math.round(g/a*100)+"%</div>",o+="</div>",o+=u?"</a>":"</div>"})),o},destructor:function(){this.tooltip&&(this.showTooltip=!1,this.tooltip.close(),this.tooltip=void 0)}},{ATTRS:{innerRadius:{value:29},outerRadius:{value:0}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-stats-photo","moment","timezone-helper","stats-helper","photo-models","photo-engagement-models","photo-stats-models","stats-photo-daily-views-models","stats-referrer-domains-models"],optional:[],langBundles:["common","stats","pika-day","photo-page-scrappy"]});YUI.add("hermes-lang-pika-day_es-us",(function(e,a){e.Intl.add("hermes/pika-day","es-US",{DATE_FORMAT:[{type:0,value:"DD-MM-YYYY"}],PREVIOUS_MONTH:[{type:0,value:"Mes anterior"}],NEXT_MONTH:[{type:0,value:"Mes siguiente"}],JANUARY:[{type:0,value:"Enero"}],FEBRUARY:[{type:0,value:"Febrero"}],MARCH:[{type:0,value:"Marzo"}],APRIL:[{type:0,value:"Abril"}],MAY:[{type:0,value:"Mayo"}],JUNE:[{type:0,value:"Junio"}],JULY:[{type:0,value:"Julio"}],AUGUST:[{type:0,value:"Agosto"}],SEPTEMBER:[{type:0,value:"Septiembre"}],OCTOBER:[{type:0,value:"Octubre"}],NOVEMBER:[{type:0,value:"Noviembre"}],DECEMBER:[{type:0,value:"Diciembre"}],SUNDAY:[{type:0,value:"Domingo"}],MONDAY:[{type:0,value:"Lunes"}],TUESDAY:[{type:0,value:"Martes"}],WEDNESDAY:[{type:0,value:"Miércoles"}],THURSDAY:[{type:0,value:"Jueves"}],FRIDAY:[{type:0,value:"Viernes"}],SATURDAY:[{type:0,value:"Sábado"}],SUNDAY_SHORT:[{type:0,value:"D"}],MONDAY_SHORT:[{type:0,value:"L"}],TUESDAY_SHORT:[{type:0,value:"M"}],WEDNESDAY_SHORT:[{type:0,value:"M"}],THURSDAY_SHORT:[{type:0,value:"J"}],FRIDAY_SHORT:[{type:0,value:"V"}],SATURDAY_SHORT:[{type:0,value:"S"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("sub-photo-right-stats-view",(function(t,e){var i=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.isOwner=e.isOwner,this.nsid=e.nsid,this.statsHelper=new t.StatsHelper,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("sub-photo-right-stats",{stats:{},loadingView:!0}),this},loadState:function(){var e=this,o={};return o.photoEngagement=this.appContext.getModel("photo-engagement-models",this.photoId),this.isOwner&&(o.personModel=this.appContext.getModel("person-models",this.nsid)),new t.FlickrPromise(o).then((function(s){var n,a,r,l;if(e.set("photo-engagement",s.photoEngagement),s.personModel)return e.isPro=s.personModel.getValue("isPro"),e.isPro?(n=t.moment().format("X"),a=new t.TimezoneHelper(e.appContext,n,"+00:00"),e.dateString||(e.dateString=a.toFormat("YYYY-MM-DD"),e.prettyDateString=a.toFormat("MMM D, YYYY"),e.realtimeDateString=e.dateString),r={date:e.dateString,photoId:e.photoId},l={id:e.statsHelper.getIdFromParams(r)},o.dailyViewsModel=e.appContext.getModel("stats-photo-daily-views-models",l,r),new t.FlickrPromise(o).then((function(t){e.dailyViewsModel=t.dailyViewsModel}),(function(t){i.error("Error loadState",{err:t})}))):t.Promise.resolve()}),(function(t){i.error("Error loadState",{err:t})}))},buildContainer:function(){var t,e,i=this.get("photo-engagement"),o=!1;return i.getValue("viewCount")>=1e6||i.getValue("faveCount")>=1e5||i.getValue("commentCount")>=1e5?e=!0:(i.getValue("viewCount")>=1e5||i.getValue("faveCount")>=1e4||i.getValue("commentCount")>=1e4)&&(t=!0),this.isOwner&&this.isPro&&this.dailyViewsModel&&this.dailyViewsModel.getValue("totals").views>0&&(o=!0),this.setContainerWithTemplate("sub-photo-right-stats",{engagement:i.toJSON(),smallText:t,superSmallText:e,showMoreStatsLink:o}),this},activate:function(){var t=this;return this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",(function(e){(e.commentCount||e.faveCount||e.reactions)&&t.buildContainer()}))),this.isOwner&&this.isPro&&this.dailyViewsModel&&this.dailyViewsModel.getValue("totals").views>0&&this.registerEventHandler(this.get("container").one(".show-more-stats").on("click",this.handleShowMoreStatsClick,this)),this},handleShowMoreStatsClick:function(e){e.halt();var i=this,o=this.photoId;new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,showCancelButton:!1,showFooter:!1,showCancelX:!0,title:i.intlMessage({intlName:"stats.PHOTO_STATS"}),subview:new t.Views["stats-photo-view"]({appContext:i.appContext,photoId:o,isOwner:i.isOwner,nsid:i.appContext.getViewer().nsid}),width:Math.round(.7*Math.max(1280,t.config.win.innerWidth)),height:540,fullWindow:!1,classList:"stats-photo-modal",hideModalOverlay:!1}).show()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-right-stats","fluid-modal-view","stats-photo-view","stats-helper"],optional:["photo-engagement-models"],langBundles:["common","photo-page-scrappy","stats","likes"]});