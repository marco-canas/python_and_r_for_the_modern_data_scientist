YUI.add("hermes-template-sub-photo-tags-tag-section",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,a,e){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:e,loc:{start:{line:2,column:35},end:{line:2,column:89}}}))+"</a>\n"},3:function(n,l,t,a,e){var o,r=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,i=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<a class="tag-section-header" href="'+i("function"==typeof(o=null!=(o=c(t,"tagPageURL")||(null!=l?c(l,"tagPageURL"):l))?o:u)?o.call(r,{name:"tagPageURL",hash:{},data:e,loc:{start:{line:6,column:37},end:{line:6,column:51}}}):o)+'">'+i((c(t,"intlMessage")||l&&c(l,"intlMessage")||u).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:6,column:53},end:{line:6,column:103}}}))+"</a>\n"},5:function(n,l,t,a,e){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<h3 class="tag-section-header">'+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:8,column:32},end:{line:8,column:82}}}))+"</h3>\n"},7:function(n,l,t,a,e){return'\t<span class="autotags-helper">\n\t\t<i class="autotags-helper-icon"></i>\n\t</span>\n'},9:function(n,l,t,a,e){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<input type="text" class= "add-tag" placeholder="'+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_TAG"},data:e,loc:{start:{line:19,column:51},end:{line:19,column:106}}}))+'">\n'},11:function(n,l,t,a,e){var o,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",s=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<li data-author="'+s(typeof(r=null!=(r=p(t,"tagAuthorNSID")||(null!=l?p(l,"tagAuthorNSID"):l))?r:i)===c?r.call(u,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:22,column:19},end:{line:22,column:36}}}):r)+'" data-tag-id="'+s(typeof(r=null!=(r=p(t,"id")||(null!=l?p(l,"id"):l))?r:i)===c?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:22,column:51},end:{line:22,column:57}}}):r)+'" class="tag '+(null!=(o=(p(t,"canRemoveTag")||l&&p(l,"canRemoveTag")||i).call(u,null!=l?p(l,"tagAuthorNSID"):l,(o=e&&p(e,"root"))&&p(o,"viewerNSID"),(o=e&&p(e,"root"))&&p(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(12,e,0),inverse:n.noop,data:e,loc:{start:{line:22,column:70},end:{line:22,column:163}}}))?o:"")+'" '+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(14,e,0),inverse:n.noop,data:e,loc:{start:{line:22,column:165},end:{line:22,column:274}}}))?o:"")+' data-track="tagClick">\n\t\t\t<a class="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(17,e,0),inverse:n.program(20,e,0),data:e,loc:{start:{line:23,column:13},end:{line:23,column:133}}}))?o:"")+'" href="#">\n\t\t\t\t<i class="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.program(25,e,0),data:e,loc:{start:{line:24,column:14},end:{line:24,column:134}}}))?o:"")+'" title="'+s((p(t,"intlMessage")||l&&p(l,"intlMessage")||i).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:24,column:143},end:{line:24,column:183}}}))+'"></i>\n\t\t\t</a>\n\t\t\t<a href="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(27,e,0),inverse:n.program(29,e,0),data:e,loc:{start:{line:26,column:12},end:{line:26,column:78}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=p(t,"tagRaw")||(null!=l?p(l,"tagRaw"):l))?r:i)===c?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:26,column:87},end:{line:26,column:97}}}):r)+'">'+s(typeof(r=null!=(r=p(t,"tagRaw")||(null!=l?p(l,"tagRaw"):l))?r:i)===c?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:26,column:99},end:{line:26,column:109}}}):r)+"</a>\n\t\t</li>\n"},12:function(n,l,t,a,e){return"can-remove-tag"},14:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"duplicateAutotagId"):l,{name:"if",hash:{},fn:n.program(15,e,0),inverse:n.noop,data:e,loc:{start:{line:22,column:194},end:{line:22,column:267}}}))?o:""},15:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'data-autotag-id="'+n.escapeExpression("function"==typeof(o=null!=(o=r(t,"duplicateAutotagId")||(null!=l?r(l,"duplicateAutotagId"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"duplicateAutotagId",hash:{},data:e,loc:{start:{line:22,column:237},end:{line:22,column:259}}}):o)+'"'},17:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"duplicateAutotagId"):l,{name:"if",hash:{},fn:n.program(18,e,0),inverse:n.program(20,e,0),data:e,loc:{start:{line:23,column:42},end:{line:23,column:108}}}))?o:""},18:function(n,l,t,a,e){return"remove-dual-tag"},20:function(n,l,t,a,e){return"remove-tag"},22:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"duplicateAutotagId"):l,{name:"if",hash:{},fn:n.program(23,e,0),inverse:n.program(25,e,0),data:e,loc:{start:{line:24,column:43},end:{line:24,column:109}}}))?o:""},23:function(n,l,t,a,e){return"delete-dual-tag"},25:function(n,l,t,a,e){return"delete-tag"},27:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(t,"url")||(null!=l?r(l,"url"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:e,loc:{start:{line:26,column:43},end:{line:26,column:50}}}):o)},29:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(t,"searchUrl")||(null!=l?r(l,"searchUrl"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"searchUrl",hash:{},data:e,loc:{start:{line:26,column:58},end:{line:26,column:71}}}):o)},31:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"each").call(null!=l?l:n.nullContext||{},null!=l?r(l,"autotags"):l,{name:"each",hash:{},fn:n.program(32,e,0),inverse:n.noop,data:e,loc:{start:{line:30,column:2},end:{line:53,column:11}}}))?o:""},32:function(n,l,t,a,e){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isPrivate"):l,{name:"if",hash:{},fn:n.program(33,e,0),inverse:n.program(38,e,0),data:e,loc:{start:{line:31,column:3},end:{line:52,column:10}}}))?o:""},33:function(n,l,t,a,e){var o,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",s=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<li class="autotag private '+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(12,e,0),inverse:n.noop,data:e,loc:{start:{line:32,column:31},end:{line:32,column:79}}}))?o:"")+'" data-autotag-content="'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:32,column:103},end:{line:32,column:119}}}):r)+'" data-autotag-id="'+s(typeof(r=null!=(r=p(t,"id")||(null!=l?p(l,"id"):l))?r:i)===c?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:32,column:138},end:{line:32,column:144}}}):r)+'" data-track="autotagClick">\n'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(34,e,0),inverse:n.noop,data:e,loc:{start:{line:33,column:5},end:{line:37,column:12}}}))?o:"")+'\t\t\t\t\t<span class="private-autotag">\n\t\t\t\t\t\t<i class="private-autotag-icon" title="'+s(n.lambda((o=e&&p(e,"root"))&&p(o,"privateAutotagHelperText"),l))+'"></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<a href="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(36,e,0),inverse:n.program(29,e,0),data:e,loc:{start:{line:41,column:14},end:{line:41,column:109}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:41,column:118},end:{line:41,column:134}}}):r)+'">'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:41,column:136},end:{line:41,column:152}}}):r)+"</a>\n\t\t\t\t</li>\n"},34:function(n,l,t,a,e){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t\t<span class="remove-autotag">\n\t\t\t\t\t\t\t<i class="delete-autotag" title="'+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:35,column:40},end:{line:35,column:80}}}))+'"></i>\n\t\t\t\t\t\t</span>\n'},36:function(n,l,t,a,e){var o,r,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return u(n.lambda((o=e&&i(e,"root"))&&i(o,"tagPageURL"),l))+u("function"==typeof(r=null!=(r=i(t,"autotagValue")||(null!=l?i(l,"autotagValue"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"autotagValue",hash:{},data:e,loc:{start:{line:41,column:65},end:{line:41,column:81}}}):r)},38:function(n,l,t,a,e){var o,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",s=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<li class="autotag '+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(12,e,0),inverse:n.noop,data:e,loc:{start:{line:44,column:23},end:{line:44,column:71}}}))?o:"")+'" data-autotag-content="'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:44,column:95},end:{line:44,column:111}}}):r)+'" data-autotag-id="'+s(typeof(r=null!=(r=p(t,"id")||(null!=l?p(l,"id"):l))?r:i)===c?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:44,column:130},end:{line:44,column:136}}}):r)+'" data-track="autotagClick">\n'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(34,e,0),inverse:n.noop,data:e,loc:{start:{line:45,column:5},end:{line:49,column:12}}}))?o:"")+'\t\t\t\t\t<a href="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(36,e,0),inverse:n.program(29,e,0),data:e,loc:{start:{line:50,column:14},end:{line:50,column:109}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:50,column:118},end:{line:50,column:134}}}):r)+'">'+s(typeof(r=null!=(r=p(t,"autotagValue")||(null!=l?p(l,"autotagValue"):l))?r:i)===c?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:50,column:136},end:{line:50,column:152}}}):r)+"</a>\n\t\t\t\t</li>\n"},40:function(n,l,t,a,e){var o,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",s=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<li data-author="'+s(typeof(r=null!=(r=p(t,"tagAuthorNSID")||(null!=l?p(l,"tagAuthorNSID"):l))?r:i)===c?r.call(u,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:64,column:20},end:{line:64,column:37}}}):r)+'" data-tag-id="'+s(typeof(r=null!=(r=p(t,"id")||(null!=l?p(l,"id"):l))?r:i)===c?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:64,column:52},end:{line:64,column:58}}}):r)+'" class="tag '+(null!=(o=(p(t,"canRemoveTag")||l&&p(l,"canRemoveTag")||i).call(u,null!=l?p(l,"tagAuthorNSID"):l,(o=e&&p(e,"root"))&&p(o,"viewerNSID"),(o=e&&p(e,"root"))&&p(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(12,e,0),inverse:n.noop,data:e,loc:{start:{line:64,column:71},end:{line:64,column:164}}}))?o:"")+'" data-track="tagClick">\n\t\t\t\t<a class="remove-tag" href="#">\n\t\t\t\t\t<i class="delete-tag" title="'+s((p(t,"intlMessage")||l&&p(l,"intlMessage")||i).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:66,column:34},end:{line:66,column:74}}}))+'"></i>\n\t\t\t\t</a>\n\t\t\t\t<a href="'+(null!=(o=p(t,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(27,e,0),inverse:n.program(29,e,0),data:e,loc:{start:{line:68,column:13},end:{line:68,column:79}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=p(t,"tagRaw")||(null!=l?p(l,"tagRaw"):l))?r:i)===c?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:68,column:88},end:{line:68,column:98}}}):r)+'">'+s(typeof(r=null!=(r=p(t,"tagRaw")||(null!=l?p(l,"tagRaw"):l))?r:i)===c?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:68,column:100},end:{line:68,column:110}}}):r)+"</a>\n\t\t\t</li>\n"},compiler:[8,">= 4.3.0"],main:function(n,l,t,a,e){var o,r=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return(null!=(o=u(t,"if").call(r,null!=l?u(l,"canAddMeta"):l,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e,loc:{start:{line:1,column:0},end:{line:3,column:7}}}))?o:"")+"\n"+(null!=(o=u(t,"if").call(r,null!=l?u(l,"linkTagToTagsPage"):l,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.program(5,e,0),data:e,loc:{start:{line:5,column:0},end:{line:9,column:7}}}))?o:"")+"\n"+(null!=(o=u(t,"if").call(r,null!=l?u(l,"showTagInfoBlock"):l,{name:"if",hash:{},fn:n.program(7,e,0),inverse:n.noop,data:e,loc:{start:{line:11,column:0},end:{line:15,column:7}}}))?o:"")+'\n<ul class="tags-list">\n'+(null!=(o=u(t,"if").call(r,null!=l?u(l,"canAddMeta"):l,{name:"if",hash:{},fn:n.program(9,e,0),inverse:n.noop,data:e,loc:{start:{line:18,column:1},end:{line:20,column:8}}}))?o:"")+(null!=(o=u(t,"each").call(r,null!=l?u(l,"tags"):l,{name:"each",hash:{},fn:n.program(11,e,0),inverse:n.noop,data:e,loc:{start:{line:21,column:1},end:{line:28,column:10}}}))?o:"")+(null!=(o=u(t,"if").call(r,null!=l?u(l,"autotagsEnabled"):l,{name:"if",hash:{},fn:n.program(31,e,0),inverse:n.noop,data:e,loc:{start:{line:29,column:1},end:{line:54,column:8}}}))?o:"")+'\n\t<div style="clear:both;"></div>\n</ul>\n\n<div style="clear:both;"></div>\n\n<div class="machine-tags-section">\n\t<ul class="machine-tags-list">\n'+(null!=(o=u(t,"each").call(r,null!=l?u(l,"machineTags"):l,{name:"each",hash:{},fn:n.program(40,e,0),inverse:n.noop,data:e,loc:{start:{line:63,column:2},end:{line:70,column:11}}}))?o:"")+'\t</ul>\n\n\t<div style="clear:both;"></div>\n</div>\n'},useData:!0}),a={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(a[l]=t)})),n.Template.register("hermes/sub-photo-tags-tag-section",(function(l,e){return(e=e||{}).partials=e.partials?n.merge(a,e.partials):a,t(l,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-tag",(function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,n,t){return'data-tag-might-exist="true"'},3:function(a,e,l,n,t){return"remove-dual-tag"},5:function(a,e,l,n,t){return"remove-tag"},7:function(a,e,l,n,t){return"delete-dual-tag"},9:function(a,e,l,n,t){return"delete-tag"},11:function(a,e,l,n,t){var r,o=null!=e?e:a.nullContext||{},u=a.hooks.helperMissing,i="function",s=a.escapeExpression,c=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return s(typeof(r=null!=(r=c(l,"tagPageURL")||(null!=e?c(e,"tagPageURL"):e))?r:u)===i?r.call(o,{name:"tagPageURL",hash:{},data:t,loc:{start:{line:5,column:35},end:{line:5,column:49}}}):r)+s(typeof(r=null!=(r=c(l,"tagWithoutSlashes")||(null!=e?c(e,"tagWithoutSlashes"):e))?r:u)===i?r.call(o,{name:"tagWithoutSlashes",hash:{},data:t,loc:{start:{line:5,column:49},end:{line:5,column:70}}}):r)},13:function(a,e,l,n,t){var r=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return a.escapeExpression((r(l,"getTagSearchUrl")||e&&r(e,"getTagSearchUrl")||a.hooks.helperMissing).call(null!=e?e:a.nullContext||{},null!=e?r(e,"tagValue"):e,{name:"getTagSearchUrl",hash:{},data:t,loc:{start:{line:5,column:78},end:{line:5,column:106}}}))},compiler:[8,">= 4.3.0"],main:function(a,e,l,n,t){var r,o,u=null!=e?e:a.nullContext||{},i=a.hooks.helperMissing,s="function",c=a.escapeExpression,g=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return'<li data-tag-id="'+c(typeof(o=null!=(o=g(l,"escapedTagRaw")||(null!=e?g(e,"escapedTagRaw"):e))?o:i)===s?o.call(u,{name:"escapedTagRaw",hash:{},data:t,loc:{start:{line:1,column:17},end:{line:1,column:34}}}):o)+'" '+(null!=(r=g(l,"if").call(u,null!=e?g(e,"mightExist"):e,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t,loc:{start:{line:1,column:36},end:{line:1,column:88}}}))?r:"")+' class="tag" data-validated="false" data-track="tagClick">\n\t<a class="'+(null!=(r=g(l,"if").call(u,null!=e?g(e,"isDualTag"):e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.program(5,t,0),data:t,loc:{start:{line:2,column:11},end:{line:2,column:68}}}))?r:"")+'" href="#">\n\t\t<i class="'+(null!=(r=g(l,"if").call(u,null!=e?g(e,"isDualTag"):e,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.program(9,t,0),data:t,loc:{start:{line:3,column:12},end:{line:3,column:69}}}))?r:"")+'" title="Delete"></i>\n\t</a>\n\t<a href="'+(null!=(r=g(l,"if").call(u,null!=e?g(e,"linkTagToTagsPage"):e,{name:"if",hash:{},fn:a.program(11,t,0),inverse:a.program(13,t,0),data:t,loc:{start:{line:5,column:10},end:{line:5,column:113}}}))?r:"")+'" title="'+c(typeof(o=null!=(o=g(l,"tagRaw")||(null!=e?g(e,"tagRaw"):e))?o:i)===s?o.call(u,{name:"tagRaw",hash:{},data:t,loc:{start:{line:5,column:122},end:{line:5,column:132}}}):o)+'">'+c(typeof(o=null!=(o=g(l,"tagRaw")||(null!=e?g(e,"tagRaw"):e))?o:i)===s?o.call(u,{name:"tagRaw",hash:{},data:t,loc:{start:{line:5,column:134},end:{line:5,column:144}}}):o)+"</a>\n</li>\n"},useData:!0}),n={};a.Array.each([],(function(e){var l=a.Template.get("hermes/"+e);l&&(n[e]=l)})),a.Template.register("hermes/sub-photo-tags-tag",(function(e,t){return(t=t||{}).partials=t.partials?a.merge(n,t.partials):n,l(e,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-tags-helper-text",(function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,l,n){var s=null!=a?a:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="tags-helper-text">\n\t'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS_HELP_TEXT"},data:n,loc:{start:{line:2,column:1},end:{line:2,column:61}}}))+'\n</div>\n<a href="https://flickrhelp.com/hc/en-us/articles/4404058631700-Tag-keywords-in-Flickr" target="_blank">'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:n,loc:{start:{line:4,column:104},end:{line:4,column:148}}}))+"</a>\n"},useData:!0}),l={};e.Array.each([],(function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)})),e.Template.register("hermes/tags-helper-text",(function(a,n){return(n=n||{}).partials=n.partials?e.merge(l,n.partials):l,t(a,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("sub-photo-tags-tag-view",(function(t,e){var a=require("hermes-core/flog")(e),s=23;t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.context=t.clone(e.context,!0),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.isMobileTags=e.isMobileTags||!1,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this;return new t.FlickrPromise({photo:e.appContext.getModel("photo-models",e.photoId),photoTags:e.appContext.getModel("photo-tags-models",this.photoId),tagModel:e.appContext.getModelRegistry("tag-models"),photoAutotags:e.appContext.getModel("photo-autotags-models",e.photoId),autotagModel:e.appContext.getModelRegistry("autotag-models")}).then((function(t){e.set("photo",t.photo),e.set("photoTags",t.photoTags),e.set("tagModel",t.tagModel),e.set("photoAutotags",t.photoAutotags),e.set("autotagModel",t.autotagModel)}))},buildContainer:function(){var t,e=this.get("photo"),a=this.get("photoTags").getValue("tags"),s=e.getValue("isOwner")||e.getValue("canAddMeta"),o=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,n=[],i=[],l=!1,g=!1,r=!1,h=this.get("photoAutotags").getValue("autotags"),d=e.getValue("isOwner"),u=!1,p=!this.isMobileTags;if(a&&0!==(a=a.toJSON()).length)for(l=!0,t=0;t<a.length;t++)o.test(a[t].tagRaw)?n.push(a[t]):i.push(a[t]);return h&&0!==(h=h.toJSON()).length&&(g=!0,u=d?this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_OWNER_HELPER_TEXT"}):this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_FRIENDS_FAMILY_HELPER_TEXT"})),l||g||(r=!0),r&&s&&(this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsTagView:tagsEmpty")),!s&&r||this.setContainerWithTemplate("sub-photo-tags-tag-section",{tags:i,machineTags:n,autotags:h,viewerIsOwner:d,privateAutotagHelperText:u,canAddMeta:e.getValue("isOwner")||e.getValue("canAddMeta"),viewerNSID:this.appContext.getViewer().nsid,isOwner:e.getValue("isOwner"),autotagsEnabled:!0,showTagInfoBlock:p,linkTagToTagsPage:!0,tagPageURL:"/photos/tags/"}),this},activate:function(){var e,a=this.get("photo"),s=this.get("container"),o=a.getValue("owner")||a.getValue("canAddMeta"),n=this.get("photoTags").getValue("tags"),i=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,l=[],g=s.one(".autotags-helper"),r=this;for(n&&(n=n.toJSON()),0===n.length&&this.fire("subviewViewEvent","noTags"),this.fire("subviewViewEvent","tagsLoaded",n),e=0;e<n.length;e++)i.test(n[e].tagRaw)&&l.push(n[e]);return l.length&&s.one(".machine-tags-section").setStyle("display","block"),!this.isMobileTags&&o&&s.one(".show-add-tags")&&(s.one(".show-add-tags").on("click",(function(t){t.preventDefault(),s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus()})),this.setupAddTagEvents(),this.setupRollOverTagEvents(),this.setupRemoveTagEvents(),this.registerEventHandler(t.on("flickr:photo-page--new-tags-added",(function(){r.buildContainer(),r.setupRollOverTagEvents(),r.setupRemoveTagEvents()}))),this.registerEventHandler(t.on("flickr:photo-page:focus_tag_entry",(function(t){var e=r.get("container");e&&e.one(".tags-list .add-tag")&&e.one(".tags-list .add-tag").focus()}))),this.attachKeyEvent("down:84",(function(t){t.preventDefault();try{s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus()}catch(t){}}))),!this.isMobileTags&&g&&this.registerEventHandler(g.on("click",(function(t){r.showAutotagsHelper(t)}),g)),this},setupAddTagEvents:function(){var t=this.get("container"),e=this;this.registerEventHandler(t.one(".add-tag").on("keydown",(function(t){13===t.charCode||13===t.keyCode?(t.preventDefault(),this.blur()):27===t.charCode&&(t.preventDefault(),this.setAttribute("data-prevent-auto-save",!0),this.blur())}))),this.registerEventHandler(t.one(".add-tag").on("blur",(function(){var a=this,s=a.get("value");""!==s&&(a.hasAttribute("data-prevent-auto-save")?a.removeAttribute("data-prevent-auto-save"):(a.set("value",""),0===s.length&&(s='""'),'""'!==s.trim()&&""!==s.trim()?(t.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".tags-list").all(".not-eol").removeClass("not-eol"),"block"===t.one(".machine-tags-section").getStyle("display")&&(t.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),e.saveTag(s),setTimeout((function(){a.focus()}),4)):this.set("text","")))})))},_whichTagList:function(){var t=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,e=this.get("container"),a=[e.one(".machine-tags-list"),e.one(".tags-list")];return function(e){return t.test(e)?a[0]:a[1]}},saveTag:function(e){var a,s,o,n,i=this.get("container"),l=this.get("tagModel"),g=this.get("photoTags").getValue("tags"),r=this.get("photoAutotags").getValue("autotags"),h=this._whichTagList(),d=this;n=this.processTag(e),o=n.map((function(t){return t.toLowerCase()})),a=g.getList().some((function(t){return-1!==o.indexOf(t.getValue("tagValue").toLowerCase())})),s=r.getList().some((function(t){return-1!==o.indexOf(t.getValue("autotagValue").toLowerCase())})),l.remoteCreate({photoId:[d.photoId],tags:[e]}).then((function(e){e.forEach((function(t){var e,a=t.getValue("tagRaw"),s=t.getValue("duplicateAutotagId"),o=h(a),n=o.one("[data-tag-id='"+escape(a)+"']");n.setAttribute("data-tag-id",t.getValue("id")),n.setAttribute("data-validated","true"),n.setAttribute("data-tag-might-exist","false"),n.setAttribute("data-author",t.getValue("tagAuthorNSID")),n.addClass("can-remove-tag"),s&&(e=o.one("[data-autotag-content='"+a+"']"),n.setAttribute("data-autotag-id",t.getValue("duplicateAutotagId")),e.remove(!0))})),t.all("[data-tag-might-exist='true']").set("text",d.intlMessage({intlName:"photo-page-scrappy.DUPLICATE_TAG"})).setAttribute("data-validated","true").addClass("invalid-tag"),t.all("[data-validated='false']").set("text",d.intlMessage({intlName:"photo-page-scrappy.INVALID_TAG"})).addClass("invalid-tag"),clearTimeout(d.invalidTagRemoval),d.invalidTagRemoval=setTimeout((function(){i.all(".invalid-tag").remove(!0)}),4500)}),(function(t){var e;e=i.all("[data-validated='false']"),i.all(".autotag").removeClass("hidden"),e.size()&&e.remove(),2===t.code?d.onError(d.intlMessage({intlName:"photo-page-scrappy.MAX_TAG_LIMIT"})):d.onError(d.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"}))})),n.forEach((function(t){var e,o,n,l=h(t).show(),g=l.hasClass("machine-tags-list"),r={tagValue:t.replace(/\s/g,""),tagRaw:t,escapedTagRaw:escape(t),mightExist:a,isDualTag:s,tagWithoutSlashes:t.replace(/\//g,""),linkTagToTagsPage:!0,tagPageURL:"/photos/tags/"};g?(t.indexOf(" ")>0?(o=t.indexOf("=")+1,n=t.substring(0,o)+'"'+t.substring(o)+'"',r.tagValue=n):r.tagValue=t,"none"===i.one(".machine-tags-section").getStyle("display")&&i.one(".machine-tags-section").setStyle("display","block"),e=d.templates("sub-photo-tags-tag")(r),l.prepend(e)):(r.tagValue=t.replace(/\s/g,""),e=d.templates("sub-photo-tags-tag")(r),s&&l.one("[data-autotag-content='"+t+"']").addClass("hidden"),l.one(".add-tag").insert(e,"after"))})),d.setupRollOverTagEvents()},setupRemoveTagEvents:function(){var e=this.get("container"),s=this.get("photoTags").getValue("tags"),o=this.get("tagModel"),n=this.get("photoAutotags").getValue("autotags"),i=this.get("autotagModel"),l={},g=e.one(".machine-tags-list"),r=this;this.registerEventHandler(e.all(".tags-list, .machine-tags-list").on("click",(function(h){if(h.target.hasClass("remove-tag")||h.target.hasClass("delete-tag")||h.target.hasClass("remove-autotag")||h.target.hasClass("delete-autotag")||h.target.hasClass("remove-dual-tag")||h.target.hasClass("delete-dual-tag")){h.preventDefault();var d,u,p=h.target.ancestor(".tag",!0);p?(d=p.getAttribute("data-tag-id"),o.remoteDelete(d).then((function(){s.removeFromList(d,"id"),p.remove(!0),0===s.toJSON().length&&0===n.toJSON().length?(e.addClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsEmpty")):0===s.toJSON().length&&e.one(".add-tag").setStyle("display","none")}),(function(){r.onError(r.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),h.target.hasClass("remove-dual-tag")||h.target.hasClass("delete-dual-tag")?(u=p.getAttribute("data-autotag-id"),l.photo_id=r.photoId,l.autotags=u,i.remoteDelete(l).then((function(){n.remove(u,"id")}),(function(){a.warn("deleting the corresponding autotag for this usertag failed")})),t.rapidTracker.beacon(r.name,"dualTagDeleteClick",{type:u})):t.rapidTracker.beacon(r.name,"tagDeleteClick")):(p=h.target.ancestor(".autotag",!0),u=p.getAttribute("data-autotag-id"),l.photo_id=r.photoId,l.autotags=u,i.remoteDelete(l).then((function(){n.remove(u,"id"),p.remove(!0),0===n.toJSON().length&&0===s.toJSON().length&&(e.one(".add-tag").setStyle("display","none"),e.addClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsEmpty"))}),(function(){r.onError(r.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),t.rapidTracker.beacon(r.name,"autotagDeleteClick",{type:u})),g.getDOMNode().childElementCount||e.one(".machine-tags-section").setStyle("display","none"),e.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".tags-list").all(".not-eol").removeClass("not-eol"),"block"===e.one(".machine-tags-section").getStyle("display")&&(e.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".machine-tags-list").all(".not-eol").removeClass("not-eol"))}})))},processTag:function(e){var a,s,o;for(a in o=e.replace(/"(.*?)"/g,(function(t,e){return e=(e=e.replace(/(,)/g,(function(t,e){return"{COMMA}","{COMMA}"}))).replace(/(\s+)/g,(function(t,e){return e="{WHITESPACE"+e.charCodeAt(0)+"}"}))})),s=o.indexOf(",")>-1?o.split(/,/):o.split(/\s+/))s[a]=s[a].replace(/\{WHITESPACE([0-9]+)\}/g,(function(t,e){return e=String.fromCharCode(e)})),s[a]=s[a].replace(/\{COMMA\}/g,(function(t,e){return",",","}));return t.Array.each(s,(function(e,a){e=t.Lang.trim(e),s[a]=e})),s=t.Array.filter(s,(function(t,e){if(t.length>0)return!0})),s},setupRollOverTagEvents:function(){var t,e=this.get("container");this.registerEventHandler(e.all(".tags-list, .machine-tags-list").on("mouseover",(function(e){if((t=e.target.ancestor(".tag, .autotag",!0))&&t.hasClass("can-remove-tag")){var a=t.ancestor(".tags-list")?t.ancestor(".tags-list").getDOMNode().offsetLeft:t.ancestor(".machine-tags-list").getDOMNode().offsetLeft,o=t.getDOMNode().offsetLeft;(t.ancestor(".tags-list")?parseInt(t.ancestor(".tags-list").getComputedStyle("width"),10):parseInt(t.ancestor(".machine-tags-list").getComputedStyle("width"),10))-(o-a+parseInt(t.getComputedStyle("width"),10))<=s?(t.removeClass("not-eol"),t.addClass("end-of-the-line")):(t.removeClass("end-of-the-line"),t.addClass("not-eol"))}})))},showAutotagsHelper:function(e){var a=this.get("container").one(".autotags-helper-icon"),s=this.templates("tags-helper-text");new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:240,observePageResize:!0,anchorElement:a,htmlMessage:s({})}).show()},onError:function(e){return this.errorDialog=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:e,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-tags-tag-section","hermes-template-sub-photo-tags-tag","hermes-template-tags-helper-text","hermes-template-head-meta","url-helper"],optional:[],langBundles:["common","photo-page-scrappy"]});