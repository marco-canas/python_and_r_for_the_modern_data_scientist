YUI.add("group-pool-by-person-models",(function(e){function o(e){o.superclass.constructor.call(this,e)}e.Models[this.name]=o,e.extend(o,e.Models["group-pool-models"],{name:this.name,attributes:e.merge(e.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(o,r){return e.AttributeHelpers.validateString(o)},setter:function(o){return e.AttributeHelpers.coerceString(o)},defaultValue:null}})})}),"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});YUI.add("group-pool-by-tag-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:null}}})}),"@VERSION@",{requires:["attribute-helpers"]});YUI.add("flickr-groups-pools-getPhotos-fetcher",(function(o,e){"use strict";o.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:function(t,r){var s=this,p=this._processParams(t),l={apiResponse:r.callAPI("flickr.groups.pools.getPhotos",p,!0),photoModelRegistry:r.getModelRegistry("photo-models"),personModelRegistry:r.getModelRegistry("person-models"),groupPoolModelRegistry:r.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),groupModelRegistry:r.getModelRegistry("group-models")};return t.personFilter&&(l.groupPoolByPersonModelRegistry=r.getModelRegistry("group-pool-by-person-models")),t.tagFilter&&(l.groupPoolByTagModelRegistry=r.getModelRegistry("group-pool-by-tag-models")),new o.FlickrPromise(l).then((function(o){return s._processResponse(o,t)}),o.FetcherErrorLogger(e))},_processParams:function(e){var t={extras:o.APIHelper.request.getRebootPhotoExtras()+","+o.APIHelper.request.getRebootGroupExtras(),per_page:e.perPage||20,page:e.page||1,get_group_info:1};if(e.id)t.group_id=o.Models["group-pool-models"].extractGroupFromCompoundId(e.id);else{if(!e.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=e.pathAlias}return e.withPhotoId&&(t.jump_to=e.withPhotoId),e.privacyFilter&&(t.privacy_filter=e.privacyFilter),e.safeSearch&&(t.safe_search=e.safeSearch),e.media&&(t.media=e.media),e.personFilter&&(t.user_id=e.personFilter),e.tagFilter&&(t.tags=e.tagFilter),t},_processResponse:function(e,t){var r,s,p,l,i=e.apiResponse,g=e.photoModelRegistry,a=e.personModelRegistry,d=e.groupPoolModelRegistry,u=e.groupPoolByPersonModelRegistry,n=e.groupPoolByTagModelRegistry,h=e.photoEngagementModelRegistry,m=e.photoStatsModelRegistry,y=e.groupModelRegistry;return i.group.pathAlias=""===i.group.pathalias?null:i.group.pathalias,r=y.parseGroupModel(i.group.nsid,i.group.pathAlias,i.group),y.addOrUpdate(r),s={pathAlias:i.group.pathAlias,group:y.proxy(r.id),filteredPoolCount:i.group.poolCount},p=o.APIHelper.response.parsePhotos({photos:i.photos.photo,personModelRegistry:a,photoModelRegistry:g,photoEngagementModelRegistry:h,photoStatsModelRegistry:m}),s.photoPageList={perPage:i.photos.perpage,page:i.photos.page,pageContent:p,totalItems:s.filteredPoolCount},t.personFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.personFilter),s.personFilter=t.personFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=u):t.tagFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.tagFilter),s.tagFilter=t.tagFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=n):(t.id&&t.id!==i.group.nsid?s.id=t.id:s.id=i.group.nsid,l=d),l.exists(s.id)?(l.setValue(s.id,"photoPageList",s.photoPageList),l.setValue(s.id,"group",s.group),l.setValue(s.id,"pathAlias",s.pathAlias),l.setValue(s.id,"filteredPoolCount",parseInt(s.filteredPoolCount,10)||0),s.group.setValue("poolCount",parseInt(i.group.poolCount,10)||0)):l.add(s),p}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models"]});YUI.add("flickr-groups-admin-acceptPhoto-updater",(function(o,e){"use strict";o.namespace("ModelUpdaters")["flickr-groups-admin-acceptPhoto"]={run:function(t,s){var r,d,i=this,p=t.registryName||"group-pool-models",l=[];return t.photoID?t.photoIds=[t.photoID]:t.photoIds="string"==typeof t.photoIds?[t.photoIds]:t.photoIds,r=this._processParams(t),d={apiResponse:s.callAPI("flickr.groups.admin.acceptPhoto",r),groupPoolModel:s.getModel(p,t.groupID),photoGroupsModelRegistry:s.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:s.getModelRegistry("photo-contexts-models"),pendingModelRegistry:s.getModelRegistry("photo-group-pending-models"),pendingsModelRegistry:s.getModelRegistry("photo-group-pendings-models"),adminPendingModelRegistry:s.getModelRegistry("group-admin-pending-models")},t.photoIds.forEach((function(o){l.push(s.getModel("photo-models",o))})),d.photoModels=o.Promise.all(l),t.unfilteredGroupId=r.group_id,"group-pool-models"!==p&&(d.unfilteredGroupPoolModel=s.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(d).then((function(o){return i._processResponse(o,t)}),o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoIds.join(","),group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t,s=o.apiResponse,r=o.groupPoolModel,d=o.photoModels,i=o.photoGroupsModelRegistry,p=o.photoContextsModelRegistry,l=o.unfilteredGroupPoolModel,g=o.pendingModelRegistry,u=o.pendingsModelRegistry,n=o.adminPendingModelRegistry;if("ok"===s.stat)return d.forEach((function(o){r&&!r.hasPhoto(o.getValue("id"))&&r.acceptPhotoLocal(o),l&&!l.hasPhoto(o.getValue("id"))&&l.acceptPhotoLocal(o),i.exists(o.id)&&!i.getValue(o.id,"groups").getFromListByID(e.unfilteredGroupId)&&(i.getValue(o.id,"groups").unshift(r),i.setValue(o.id,"total",i.getValue(o.id,"total")+1)),p.exists(o.id)&&!p.getValue(o.id,"contexts").getFromListByID(e.unfilteredGroupId)&&(p.setValue(o.id,"totalGroups",p.getValue(o.id,"totalGroups")+1),p.getValue(o.id,"contexts").push(r)),t=[o.id,e.unfilteredGroupId].join("-"),u.exists(o.id)&&u.getValue(o.id,"pendings").getFromListByID(t)&&(u.setValue(o.id,"total",u.getValue(o.id,"total")-1),u.getValue(o.id,"pendings").removeFromList(t)),g.remove(t),n.exists(e.groupID)&&n.removePhotoLocal(e.groupID,o.id)})),r}}}),"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-admin-declinePhoto-deletor",(function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-groups-admin-declinePhoto"]={run:function(t,r){var s,d,i=this,l=t.registryName||"group-pool-models",p=[];return t.photoID?t.photoIds=[t.photoID]:t.photoIds="string"==typeof t.photoIds?[t.photoIds]:t.photoIds,s=this._processParams(t),d={apiResponse:r.callAPI("flickr.groups.admin.declinePhoto",s),groupPoolModel:r.getModel(l,t.groupID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models"),adminPendingModelRegistry:r.getModelRegistry("group-admin-pending-models")},t.photoIds.forEach((function(o){p.push(r.getModel("photo-models",o))})),d.photoModels=o.Promise.all(p),t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(d.unfilteredGroupPoolModel=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(d).then((function(o){return i._processResponse(o,t)}),o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoIds.join(","),group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModel,s=o.photoModels,d=o.photoGroupsModelRegistry,i=o.photoContextsModelRegistry,l=o.unfilteredGroupPoolModel,p=o.adminPendingModelRegistry;if("ok"===t.stat)return s.forEach((function(o){i.exists(o.id)&&i.getValue(o.id,"contexts").getFromListByID(e.unfilteredGroupId)&&(i.setValue(o.id,"totalGroups",i.getValue(o.id,"totalGroups")-1),i.getValue(o.id,"contexts").removeFromList(e.unfilteredGroupId)),d.exists(o.id)&&d.getValue(o.id,"groups").getFromListByID(e.unfilteredGroupId)&&(d.setValue(o.id,"total",d.getValue(o.id,"total")-1),d.getValue(o.id,"groups").removeFromList(e.unfilteredGroupId)),p.exists(e.groupID)&&p.removePhotoLocal(e.groupID,o.id),r&&r.declinePhotoLocal(o),l&&l.declinePhotoLocal(o)})),r}}}),"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-contributor-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateJoined:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")}},groupDiscussionCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},groupPhotoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},rank:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},realname:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},username:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoTitle:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},buddyicon:{},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(t,e){return!!this.getValue(e,"latestPhotoId")&&this.getValue(e,"contributorUrl")+this.getValue(e,"latestPhotoId")+"/"}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(t,e){return this.getValue(e,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(t,e){return"/photos/"+(this.getValue(e,"pathAlias")||this.getValue(e,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(e){return t.AttributeHelpers.coerceBoolean(e)}},proBadge:{defaultValue:"standard",setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});YUI.add("flickr-groups-getTopContributors-fetcher",(function(o,r){"use strict";function t(r,t,e){var i={id:t+"-"+r.id+"-"+e,nsid:r.id,dateJoined:r.dateJoined?o.moment(r.dateJoined.toString(),"X"):o.moment(),groupDiscussionCount:r.groupDiscussionCount,groupPhotoCount:r.groupPhotoCount,pathAlias:r.pathAlias,rank:r.rank,realname:r.realname,username:r.username,isPro:r.isPro,proBadge:r.proBadge,buddyicon:r.iconurls};return r.latestPhoto&&(i.latestPhotoId=r.latestPhoto.id,i.latestPhotoTitle=r.latestPhoto.name),i}o.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:function(t,e){var i=this;return o.Promise.all([e.callAPI("flickr.groups.getTopContributors",this._processParams(t),!0),e.getModelRegistry("group-top-contributors-models"),e.getModelRegistry("group-contributor-models")]).then((function(o){return i._processResponse(o,t)}),o.FetcherErrorLogger(r))},_processParams:function(o){return{group_id:o.id,type:"all",extras:"include_viewer,is_pro,icon_urls"}},_processResponse:function(o,r){var e,i,s,n=o[0],u=o[1],a=o[2];return i={photoContributors:[],discussionContributors:[],id:r.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach((function(o){n.contributors[o.k]&&(e=n.contributors[o.k]).contributor&&e.contributor.forEach((function(e){s=t(e,o.k,r.id),i[o.v].push(a.addOrUpdate(s))}))})),n&&n.viewer&&0!==n.viewer.length?(s=t(n.viewer,"viewer",r.id),i.viewer=a.addOrUpdate(s)):i.viewer=null,u.addOrUpdate(i),u.proxy(i.id)}}}),"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});