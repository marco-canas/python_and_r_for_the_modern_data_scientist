YUI.add("flickr-photos-addNotes-creator",(function(o,t){"use strict";o.namespace("ModelCreators")["flickr-photos-addNotes"]={run:function(e,r){var n=this;return o.Promise.all([r.callAPI("flickr.photos.notes.add",this._processParams(e)),r.getModelRegistry("photo-notes-models"),r.getModelRegistry("note-models")]).then((function(o){return n._processResponse(o,e)}),o.FetcherErrorLogger(t))},_processParams:function(o){return{photo_id:o.photoId,note_x:o.left,note_y:o.top,note_w:o.width,note_h:o.height,note_text:o.text}},_processResponse:function(o,t){var e,r=o[0],n=o[1],s=o[2];return s.addOrUpdate({id:r.note.id,left:r.note.x,top:r.note.y,width:r.note.w,height:r.note.h,text:r.note.content,author:r.note.author,authorName:r.note.authorname,authorRealName:r.note.authorrealname,authorIsPro:r.note.authorispro,authorProBadge:r.note.authorProBadge,authorIsDeleted:r.note.authorisdeleted}),e=s.proxy(r.note.id),n.exists(t.photoId)?n.getValue(t.photoId,"notes").appendToList(e):n.add({id:t.photoId,notes:[e]}),e}}}),"@VERSION@",{requires:["flickr-promise"],optional:["photo-notes-models","note-models"]});YUI.add("flickr-photos-editNote-updater",(function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-editNote"]={run:function(o,n){var s=this;return e.Promise.all([n.callAPI("flickr.photos.notes.edit",this._processParams(o)),n.getModelRegistry("photo-notes-models"),n.getModelRegistry("note-models")]).then((function(e){return s._processResponse(e,o)}),e.FetcherErrorLogger(t))},_processParams:function(e){return{note_id:e.noteId,note_x:e.noteX,note_y:e.noteY,note_w:e.noteW,note_h:e.noteH,note_text:e.noteText}},_processResponse:function(e,t){var o,n=e[0],s=e[1];return(o=e[2].proxy(n.note.id)).setValues({left:n.note.x,top:n.note.y,width:n.note.w,height:n.note.h,text:n.note.content}),s.getValue(n.note.photoId,"notes").getFromListByID(n.note.id).setValues({left:n.note.x,top:n.note.y,width:n.note.w,height:n.note.h,text:n.note.content}),o}}}),"@VERSION@",{requires:["flickr-promise"],optional:["photo-notes-models","note-models"]});YUI.add("flickr-photos-deleteNote-deletor",(function(e,o){"use strict";e.namespace("ModelDeletors")["flickr-photos-deleteNote"]={run:function(t,r){var l={note_id:t};return r.callAPI("flickr.photos.notes.delete",l).then(null,e.FetcherErrorLogger(o))}}}),"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("note-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-addNotes"].run(t,this.appContext)},update:function(t,r){var n;return n={noteId:t,noteX:this.getValue(t,"left"),noteY:this.getValue(t,"top"),noteW:this.getValue(t,"width"),noteH:this.getValue(t,"height"),noteText:this.getValue(t,"text")},e.ModelUpdaters["flickr-photos-editNote"].run(n,this.appContext)},delete:function(t){return e.ModelDeletors["flickr-photos-deleteNote"].run(t,this.appContext)}},attributes:{author:{setter:function(e){return e}},authorName:{setter:function(e){return e}},authorRealName:{setter:function(e){return e}},authorIsPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},authorProBadge:{defaultValue:"standard",setter:function(t){return e.AttributeHelpers.coerceString(t)}},authorIsDeleted:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},left:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},top:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},width:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},height:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},text:{setter:function(e){return e}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-addNotes-creator","flickr-photos-editNote-updater","flickr-photos-deleteNote-deletor","attribute-helpers"]});YUI.add("flickr-photos-deleteAutotags-deletor",(function(e,t){"use strict";e.namespace("ModelDeletors")["flickr-photos-deleteAutotags"]={run:function(o,r){return r.callAPI("flickr.photos.deleteAutotags",o).then(null,e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("autotag-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{delete:function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotagValue:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},score:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isPrivate:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},searchUrl:{derivedBy:["autotagValue"],readOnly:!0,defaultFn:function(e){return"/search/?q="+this.getValue(e,"autotagValue")}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});YUI.add("photo-autotags-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{delete:function(e){return t.ModelDeletors["flickr-photos-deleteAutotags"].run(e,this.appContext)}},attributes:{autotags:{isCollection:!0}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});YUI.add("flickr-photos-getInfo-fetcher",(function(e,o){"use strict";e.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:function(t,s){var r,i=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),!0,r=this._processParams(t),new e.FlickrPromise({apiResponse:s.callAPI("flickr.photos.getInfo",r,true),photoRegistry:s.getModelRegistry("photo-models"),personRegistry:s.getModelRegistry("person-models"),personRelationshipRegistry:s.getModelRegistry("person-relationship-models"),photoEngagementRegistry:s.getModelRegistry("photo-engagement-models"),photoStatsRegistry:s.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:s.getModelRegistry("photo-privacy-models"),photoNotesRegistry:s.getModelRegistry("photo-notes-models"),noteRegistry:s.getModelRegistry("note-models"),photoGeoRegistry:s.getModelRegistry("photo-geo-models"),photoLocationRegistry:s.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:s.getModelRegistry("photo-head-meta-models"),groupRegistry:s.getModelRegistry("group-models"),contextsRegistry:s.getModelRegistry("photo-contexts-models"),favoriteRegistry:s.getModelRegistry("favorite-models"),galleryRegistry:s.getModelRegistry("gallery-models"),groupsPoolRegistry:s.getModelRegistry("group-pool-models"),setRegistry:s.getModelRegistry("set-models"),photostreamRegistry:s.getModelRegistry("photostream-models")}).then((function(e){return i._processResponse(e,s.flipper,r)}),e.FetcherErrorLogger(o))},_processParams:function(o){var t;return t={datecreate:1,extras:["sizes","icon_urls","ignored","rev_ignored","rev_contacts","venue","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"},o.userId?t.user_id=o.userId:o.pathAlias&&(t.path_alias=o.pathAlias),o.context&&(t.context=o.context,t.num_prev=1,t.num_next=1),o.scrappy&&(e.APIHelper.request.addStaticMapsParams(t),delete t.get_contexts,delete t.primary_photo_extras,delete t.context),t},_processResponse:function(o,t,s){var r,i,n,p,a,d,h,l,g,c,y=o.apiResponse,m=o.photoRegistry,R=o.personRegistry,u=o.personRelationshipRegistry,v=o.photoEngagementRegistry,M=o.photoStatsRegistry,f=o.photoPrivacyRegistry,x=o.photoNotesRegistry,P=o.noteRegistry,w=o.photoGeoRegistry,I=o.photoLocationRegistry,_=o.photoHeadMetaRegistry,A=o.groupRegistry,k={},b=[];if(!y.photo.sizes)throw new Error("Missing photo sizes from flickr.photos.getInfo call.");i={id:y.photo.id,title:y.photo.title.content,description:y.photo.description.content,sizes:e.APIHelper.response.parsePhotoSize(y.photo.sizes.size,!0),needsInterstitial:y.photo.needsInterstitial,canComment:y.photo.editability.cancomment,canPublicComment:y.photo.publiceditability.cancomment,canAddMeta:y.photo.editability.canaddmeta,safetyLevel:y.photo.safetyLevel,license:y.photo.license,mediaType:y.photo.media,secret:y.photo.secret,rotation:y.photo.rotation,oWidth:y.photo.oWidth?parseInt(y.photo.oWidth,10):"",oHeight:y.photo.oHeight?parseInt(y.photo.oHeight,10):"",visibilitySource:y.photo.visibilitySource,isVideoPending:y.photo.video?y.photo.video.pending:0,isVideoFailed:y.photo.video?y.photo.video.failed:0,systemModerated:y.photo.system_moderated||0},n={id:y.photo.owner.nsid,username:y.photo.owner.username,realname:y.photo.owner.realname,pathAlias:y.photo.owner.pathAlias,buddyicon:e.APIHelper.response.removeProtocolFromURL(y.photo.owner.iconurls),isAdFree:y.photo.owner.isAdFree,isPro:y.photo.owner.ispro,proBadge:y.photo.owner.proBadge,dateCreated:y.photo.owner.datecreate,location:y.photo.owner.location},p={id:y.photo.owner.nsid,pathAlias:y.photo.owner.pathAlias,isContact:y.photo.contactIscontact,isFamily:y.photo.contactIsfamily,isFriend:y.photo.contactIsfriend,isIgnored:y.photo.owner.isignored,isIgnoredBy:y.photo.owner.revIgnored,isRevContact:y.photo.owner.revContact,isRevFamily:y.photo.owner.revFamily,isRevFriend:y.photo.owner.revFriend},a={id:y.photo.id,ownerNsid:y.photo.owner.nsid,isFaved:y.photo.isfavorite||!1,canShare:y.photo.usage.canshare,canDownload:y.photo.usage.candownload,canPrint:y.photo.usage.canprint,commentCount:y.photo.comments.content,noteCount:y.photo.notes&&y.photo.notes.note&&y.photo.notes.note.length,faveCount:y.photo.countFaves,viewCount:y.photo.views},d={id:y.photo.id,dateTaken:y.photo.dates.taken,datePosted:y.photo.dates.posted,takenGranularity:y.photo.dates.takengranularity,isDateTakenUnknown:y.photo.datetakenunknown||"1"===y.photo.datetakenunknown||1===y.photo.datetakenunknown},l=e.APIHelper.response.parsePhotoMeta(y.photo),h={id:y.photo.id,isPublic:y.photo.visibility.ispublic,isVisibleByFriends:y.photo.visibility.isfriend,isVisibleByFamily:y.photo.visibility.isfamily,permAddMeta:y.photo.permissions?y.photo.permissions.permaddmeta:0,permComment:y.photo.permissions?y.photo.permissions.permcomment:0,permPrint:y.photo.permissions?y.photo.permissions.permprint:0,isHidden:y.photo.visibility.hidden},y.photo&&y.photo.notes&&y.photo.notes.note&&e.Array(y.photo.notes.note).forEach((function(e){b.push(P.addOrUpdate({id:e.id,author:e.author,authorName:e.authorname,authorRealName:e.authorrealname,authorIsPro:e.authorispro,authorProBadge:e.proBadge,authorIsDeleted:e.authorisdeleted,left:e.x,top:e.y,width:e.w,height:e.h,text:e.content}))})),g=e.ModelFetchers["flickr-photos-getLocation"].mapResponse(y,w),i.owner=R.addOrUpdate(n),i.engagement=v.addOrUpdate(a),u.addOrUpdate(p),c=m.addOrUpdate(i),M.addOrUpdate(d),f.addOrUpdate(h),x.addOrUpdate({id:i.id,notes:b}),_.addOrUpdate(l),I.addOrUpdate(g),y.photo.contexts&&(r=o.contextsRegistry,k.faves=o.favoriteRegistry,k.gallery=o.galleryRegistry,k.pool=o.groupsPoolRegistry,k.set=o.setRegistry,k.stream=o.photostreamRegistry,(function(o){var t=o.photoModel,s=o.contextRegistries,r=o.contextsResponse,i=o.personRegistry,n=o.contextsRegistry,p=o.photoEngagementRegistry,a=o.photoStatsRegistry,d=o.groupRegistry,h=o.apiParams,l=[];e.Object.each(s,(function(o,s){r[s]&&e.Array.each(r[s],(function(s){var r,n,g,c,y,m,R,u,v;e.APIHelper.response.addContextToRegistry(s,o,i,d),l.push(o.proxy(s.id)),h.context&&(n=!!(r=o.getValue(s.id,"photoContextList")).hasMinBoundary&&r.hasMinBoundary(),g=!!r.hasMaxBoundary&&r.hasMaxBoundary(),c=r.getList(),m=s.nextphotos,R=s.prevphotos,u=m?e.APIHelper.response.parsePhotos({photos:m.photo,personModelRegistry:i,photoModelRegistry:t.registry,photoEngagementModelRegistry:p,photoStatsModelRegistry:a}):[],((v=R?e.APIHelper.response.parsePhotos({photos:R.photo,personModelRegistry:i,photoModelRegistry:t.registry,photoEngagementModelRegistry:p,photoStatsModelRegistry:a}):[]).length||u.length)&&(y=e.APIHelper.response.addOrReplaceListByContext({model:t,next:u,prev:v.reverse(),current:c,hasMin:n,hasMax:g,numNext:h.num_next,numPrev:h.num_prev})),o.setValue(s.id,"photoContextList",y))}))})),n.exists(t.id)||(n.add({id:t.id,totalGroups:r.pool?r.pool.length:0,totalSets:r.set?r.set.length:0,totalGalleries:r.gallery?r.gallery.length:0}),n.setValue(t.id,"contexts",l))})({photoModel:c,contextRegistries:k,contextsResponse:y.photo.contexts,personRegistry:R,contextsRegistry:r,photoEngagementRegistry:v,photoStatsRegistry:M,groupRegistry:A,apiParams:s}))}}}),"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]});