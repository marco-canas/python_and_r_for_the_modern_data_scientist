YUI.add("flickr-groups-unfave-fetcher",(function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-groups-unfave"]={run:function(s,o){return e.Promise.all([o.callAPI("flickr.groups.unfave",s),o.getModelRegistry("person-groups-models")]).then(this._processResponse,e.FetcherErrorLogger(r))},_processResponse:function(e){}}}),"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});YUI.add("flickr-people-getGroupsWithStatus-fetcher",(function(e,t){"use strict";e.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:function(s,i){var r=this,o={extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:s.id,status:s.status};return s.id!==i.getViewer().nsid&&(o.public_only=1,o.status="2,3,4"),e.Promise.all([i.callAPI("flickr.people.getGroupsWithStatus",o,!0),i.getModelRegistry("person-groups-models"),i.getModelRegistry("group-models"),i.getModelRegistry("group-activity-models")]).then((function(e){return r._processResponse(e,s)}),e.FetcherErrorLogger(t))},_processResponse:function(t,s){var i,r=t[0],o=t[1],a=t[2],u=t[3],d=r.groups,l=s.id,p={},n=[];if(d)return e.Array.each(d,(function(t,r){var o,d,l,p=a.parseGroupModel(s.id,s.pathAlias,t);t.id&&(o=a.addOrUpdate(p),n.push(o),t.viewDates?(d="0"!==t.viewDates.pool?e.moment(t.viewDates.pool,"X"):u.getDefaultViewedDate(),(l="0"!==t.viewDates.discussions?e.moment(t.viewDates.discussions,"X"):u.getDefaultViewedDate()).isValid()||(l=u.getDefaultViewedDate()),d.isValid()||(d=u.getDefaultViewedDate())):(d=u.getDefaultViewedDate(),l=u.getDefaultViewedDate()),i={id:p.id,viewedPool:d,viewedDiscussions:l,group:o},u.addOrUpdate(i))})),(p={id:l,memberCount:r.members?r.members:null,moderatorCount:0,adminCount:0,invitedCount:0})[s.attribute]=n,o.exists(l)?o.setValue(l,s.attribute,p[s.attribute]):o.add(p),p[s.attribute]}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]});YUI.add("person-groups-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},faveGroup:function(t,r){return e.ModelFetchers["flickr-groups-fave"].run(t,r)},unfaveGroup:function(t,r){return e.ModelFetchers["flickr-groups-unfave"].run(t,r)}},faveGroup:function(e){var t=this,r=e.group_id,o=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,(function(){t.appContext.getModel("group-models",r).then((function(e){t.getValue(o,"groupsFaved").removeFromList(r)}))})),this.appContext.getModel("group-models",r).then((function(e){t.getValue(o,"groupsFaved").appendToList(e)}))},unfaveGroup:function(e){var t=e.group_id,r=e.user_id,o=this;return this.remote.unfaveGroup(e,this.appContext).then(null,(function(){o.appContext.getModel("group-models",t).then((function(e){o.getValue(r,"groupsFaved").appendToList(e)}))})),this.appContext.getModel("group-models",t).then((function(e){o.getValue(r,"groupsFaved").removeFromList(t)}))},attributes:{id:{},memberCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},moderatorCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},adminCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},invitedCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},groups:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]});YUI.add("flickr-photos-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.getContext",this._processParams(t,s),!0),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then((function(e){return r._processResponse(e,t)}),e.FetcherErrorLogger(o))},_processParams:function(o,t){var s;return s={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},o.viewAs&&(s.view_as=o.viewAs),o.orderBy&&(s.order_by=o.orderBy),s},_processResponse:function(o,t){var s,r,n,p,a,i,h,l,d=o[0],g=o[1],u=o[2],m=o[3],c=o[4],x=[],y=u.proxy(t.photoId),M=y.getValue("owner");return r=d.prevphotos,n=d.nextphotos,s=e.APIHelper.response.parsePhotos({photos:r.photo,existingPerson:M,photoModelRegistry:u,photoEngagementModelRegistry:m,photoStatsModelRegistry:c}),x=e.APIHelper.response.parsePhotos({photos:n.photo,existingPerson:M,photoModelRegistry:u,photoEngagementModelRegistry:m,photoStatsModelRegistry:c}),i=!!(a=g.getValue(t.id,"photoContextList")).hasMinBoundary&&a.hasMinBoundary(),h=!!a.hasMaxBoundary&&a.hasMaxBoundary(),p=a.getList(),l=e.APIHelper.response.addOrReplaceListByContext({model:y,next:s,prev:x.reverse(),hasMin:i,hasMax:h,current:p,numNext:t.numNext,numPrev:t.numPrev}),g.setValue(t.id,"photoContextList",l),{next:s,previous:x.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photos-getPerms-fetcher",(function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:function(s,i){var o={photo_id:s.id},t=this;return e.Promise.all([i.callAPI("flickr.photos.getPerms",o),i.getModelRegistry("photo-privacy-models")]).then((function(e){return t._processResponse(e,s)}),e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,i=e[0],o=e[1];s={id:r.id,isPublic:i.perms.ispublic,isVisibleByFriends:i.perms.isfriend,isVisibleByFamily:i.perms.isfamily,permAddMeta:i.perms.permaddmeta,permComment:i.perms.permcomment},o.addOrUpdate(s)}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});YUI.add("photo-privacy-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,r){var i;return i={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment"),perm_print:this.getValue(t,"permPrint")},e.ModelUpdaters["flickr-photos-setPerms"].run(i,this.appContext)},batchUpdate:function(t,r){var i={};return i.photo_ids=t,"privacy"in r&&(i.is_public=r.privacy.isPublic,i.is_friend=r.privacy.isVisibleByFriends,i.is_family=r.privacy.isVisibleByFamily),"commenting"in r&&(i.perm_comment=r.commenting),"addMeta"in r&&(i.perm_addmeta=r.addMeta),"permPrint"in r&&(i.perm_print=r.permPrint),i.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(i,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isHidden:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permPrint:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});YUI.add("flickr-people-getPhotos-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:function(t,s){var r=this,p=[s.callAPI("flickr.people.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("photo-privacy-models")];return t.createCompoundID&&s.getViewer().signedIn&&s.getViewer().nsid&&p.push(s.getModel("person-preferences-models",s.getViewer().nsid)),e.Promise.all(p).then((function(e){return r._processResponse(e,t)}),e.FetcherErrorLogger(o))},_processParams:function(o){var t={per_page:o.perPage||20,page:o.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:o.withPhotoId||""};return o.id||o.userId?t.user_id=(o.id||o.userId).split("-")[0]:o.pathAlias&&(t.path_alias=o.pathAlias),o.privacyFilter&&(t.privacy_filter=o.privacyFilter),o.viewAs&&(t.view_as=o.viewAs),o.orderBy&&("datetaken"===o.orderBy?t.sort="date-taken-desc":t.sort=o.orderBy),o.safeSearch&&(t.safe_search=o.safeSearch),o.media&&(t.media=o.media),o.withPhotoId&&(t.jump_to=o.withPhotoId),o.contentType&&(t.content_type=o.contentType),t},_processResponse:function(o,t){var s,r,p=o[0],a=o[1],i=o[2],d=o[3],n=o[4],l=o[5],h=o[6],g=p&&p.user?p.user.nsid:null,c=t.id||t.userId;if(!g)throw new Error("API was missing valid nsid");return r={id:g,pathAlias:p.user.pathAlias,owner:e.APIHelper.response.parsePerson(p.user),totalItems:p.photos.total},c&&c!==g&&(r.id=c),o[7]&&(r.id=g+"-"+e.Models["person-preferences-models"].buildContextSuffix(o[7],g)),r.owner=i.addOrUpdate(r.owner),s=e.APIHelper.response.parsePhotos({photos:p.photos.photo,ownerID:p.photos.owner,personModelRegistry:i,photoModelRegistry:a,photoEngagementModelRegistry:n,photoStatsModelRegistry:l,photoPrivacyModelRegistry:h}),r.photoPageList={perPage:p.photos.perpage,page:p.photos.page,pageContent:s,totalItems:parseInt(p.photos.total,10)||0},d.addOrUpdate(r),s}}}),"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});