YUI.add("hermes-template-search-photos-single-row",(function(l,n){var e=l.Template.Handlebars.revive({1:function(l,n,e,t,a){var o,r,i=null!=n?n:l.nullContext||{},s=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t<h5 class="search-results-header">'+(null!=(o=s(e,"unless").call(i,null!=n?s(n,"loading"):n,{name:"unless",hash:{},fn:l.program(2,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:35},end:{line:2,column:278}}}))?o:"")+l.escapeExpression("function"==typeof(r=null!=(r=s(e,"title")||(null!=n?s(n,"title"):n))?r:l.hooks.helperMissing)?r.call(i,{name:"title",hash:{},data:a,loc:{start:{line:2,column:278},end:{line:2,column:287}}}):r)+" "+(null!=(o=s(e,"if").call(i,null!=n?s(n,"loading"):n,{name:"if",hash:{},fn:l.program(6,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:288},end:{line:2,column:348}}}))?o:"")+"</h5>\n"+(null!=(o=s(e,"if").call(i,null!=n?s(n,"loading"):n,{name:"if",hash:{},fn:l.program(8,a,0),inverse:l.program(10,a,0),data:a,loc:{start:{line:3,column:1},end:{line:7,column:8}}}))?o:"")},2:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=r(e,"unless").call(null!=n?n:l.nullContext||{},null!=n?r(n,"singleResult"):n,{name:"unless",hash:{},fn:l.program(3,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:54},end:{line:2,column:267}}}))?o:""},3:function(l,n,e,t,a){var o,r,i=null!=n?n:l.nullContext||{},s=l.hooks.helperMissing,u=l.escapeExpression,c=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<a href="'+u("function"==typeof(r=null!=(r=c(e,"viewAll")||(null!=n?c(n,"viewAll"):n))?r:s)?r.call(i,{name:"viewAll",hash:{},data:a,loc:{start:{line:2,column:87},end:{line:2,column:98}}}):r)+'" class="view-more-link"'+(null!=(o=c(e,"if").call(i,null!=n?c(n,"viewAllDataTrack"):n,{name:"if",hash:{},fn:l.program(4,a,0),inverse:l.noop,data:a,loc:{start:{line:2,column:122},end:{line:2,column:187}}}))?o:"")+">"+u((c(e,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||s).call(i,{name:"intlHTMLMessage",hash:{count:null!=n?c(n,"total"):n,intlName:"search.VIEW_ALL_COUNT"},data:a,loc:{start:{line:2,column:188},end:{line:2,column:252}}}))+"</a>"},4:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return' data-track="'+l.escapeExpression("function"==typeof(o=null!=(o=r(e,"viewAllDataTrack")||(null!=n?r(n,"viewAllDataTrack"):n))?o:l.hooks.helperMissing)?o.call(null!=n?n:l.nullContext||{},{name:"viewAllDataTrack",hash:{},data:a,loc:{start:{line:2,column:159},end:{line:2,column:179}}}):o)+'"'},6:function(l,n,e,t,a){return'<div class="flickr-dots inline"></div>'},8:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t<div style="height: '+l.escapeExpression("function"==typeof(o=null!=(o=r(e,"placeholderHeight")||(null!=n?r(n,"placeholderHeight"):n))?o:l.hooks.helperMissing)?o.call(null!=n?n:l.nullContext||{},{name:"placeholderHeight",hash:{},data:a,loc:{start:{line:4,column:22},end:{line:4,column:43}}}):o)+'px;"></div>\n'},10:function(l,n,e,t,a){var o=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t"+l.escapeExpression((o(e,"outlet")||n&&o(n,"outlet")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},null!=n?o(n,"photo-list-view"):n,{name:"outlet",hash:{},data:a,loc:{start:{line:6,column:2},end:{line:6,column:28}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=r(e,"unless").call(null!=n?n:l.nullContext||{},null!=n?r(n,"emptySearch"):n,{name:"unless",hash:{},fn:l.program(1,a,0),inverse:l.noop,data:a,loc:{start:{line:1,column:0},end:{line:8,column:11}}}))?o:""},useData:!0}),t={};l.Array.each([],(function(n){var e=l.Template.get("hermes/"+n);e&&(t[n]=e)})),l.Template.register("hermes/search-photos-single-row",(function(n,a){return(a=a||{}).partials=a.partials?l.merge(t,a.partials):t,e(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-lite-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{update:e.PhotoModelHelper.updateEngagement,addReaction:function(t){return e.ModelUpdaters["flickr-reactions-add"].run(t,this.appContext)},removeReaction:function(t){return e.ModelUpdaters["flickr-reactions-remove"].run(t,this.appContext)}},toggleFave:e.PhotoModelHelper.toggleFave,addAsFave:e.PhotoModelHelper.addAsFave,toggleReaction:function(e,t,r){var o="photo-engagement-models",i=this.getValue(e,"reactions")[t].count,a=Object.assign({},this.getValue(e,"reactions")),n=Object.assign({},a[t]);return n.didViewerReact=r,n.count=r?i+1:i-1,a[t]=n,this.setValue(e,"reactions",a),this.name!==o&&this.appContext.getModelRegistry(o).then((function(o){o.exists(e)&&o.toggleReaction(e,t,r)})),this.getValue(e,"reactions")[t]},updateReactionRemote:function(t,r){return e.Promise.resolve({})},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,attributes:{owner:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{id:r.getValue(t,"ownerNsid"),getValue:function(e){return"id"===e||"nsid"===e?r.getValue(t,"ownerNsid"):"url"===e?r.getValue(t,"ownerUrl"):r.getValue(t,e)},toJSON:function(){return{id:r.getValue(t,"ownerNsid"),url:r.getValue(t,"ownerUrl"),pathAlias:r.getValue(t,"pathAlias"),username:r.getValue(t,"username"),realname:r.getValue(t,"realname"),displayname:r.getValue(t,"displayname"),nsid:r.getValue(t,"ownerNsid"),ownerUrl:r.getValue(t,"ownerUrl"),isMe:r.getValue(t,"isMe")}},exists:function(e){return!1}}}},pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,ownerUrl:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,engagement:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{registry:this,getValue:function(e){return r.getValue(t,e)},toJSON:function(){return{ownerNsid:r.getValue(t,"ownerNsid"),isFaved:r.getValue(t,"isFaved"),faveCount:r.getValue(t,"faveCount"),commentCount:r.getValue(t,"commentCount"),canFave:r.getValue(t,"canFave"),reactions:r.getValue(t,"reactions")}},exists:function(e){return!1}}}},ownerNsid:e.PhotoModelHelper.attributes.ownerNsid,isFaved:e.PhotoModelHelper.attributes.isFaved,faveCount:e.PhotoModelHelper.attributes.faveCount,commentCount:e.PhotoModelHelper.attributes.commentCount,canFave:e.PhotoModelHelper.attributes.canFave,title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},reactions:{defaultValue:{like:{id:"like",count:5,didViewerReact:!0,canReact:!0},someOtherReaction:{id:"someOtherReaction",count:3,didViewerReact:!1,canReact:!0}},derivedBy:["canFave"],getter:function(e,t){var r=this.getValue(t,"canFave");return e&&e.like&&(e.like.canReact=r,e.like.didViewerReact=!!r&&e.like.didViewerReact),e}}}})}),"@VERSION@",{requires:["flickr-model-registry","photo-model-helper","person-model-helper","flickr-favorites-add-updater","flickr-favorites-remove-updater","photo-models","photo-engagement-models","person-models"]});YUI.add("search-photos-lite-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return t.getPhotoLiteModels=!0,e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{fetchParams:{getPhotoLiteModels:!0},listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher","attribute-helpers"]});YUI.add("flickr-photos-search-fetcher",(function(e,o){"use strict";var t=require("superagent"),r=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photos-search"]={run:function(s,a){var p,i=this,l=s.emptyQuery?{}:this._processParams(e.merge({lang:a.lang||e.config.lang},s),a);if(l||(s.emptyQuery=!0),s.useV2API){var n=s.apiParams.tags||s.apiParams.text,h={orderBy:"interestingness",query:n,pageNumber:s.page-1>=0?s.page-1:0,pageSize:s.perPage,format:"json",nojsoncallback:1};s.minDateTaken&&s.maxDateTaken&&(s.apiParams.tags||s.apiParams.text)&&(h.query=e.SearchHelper.normalizeTag(n),h.context="tag:"+e.SearchHelper.normalizeTag(n)+" dateUploaded:["+s.minDateTaken+" TO "+s.maxDateTaken+"]"),p=[t.get("https://api.flickr.com/v2/media/search").use(require("hermes-core/req-id")).query(h).catch((function(e){return r.warn("API V2 Search returned a non valid response",{err:e}),{body:[],headers:{"x-total-count":0}}}))]}else p=[s.emptyQuery?e.Promise.resolve({photos:{photo:[]}}):a.callAPI("flickr.photos.search",l)];return p=s.getPhotoLiteModels?p.concat([a.getModelRegistry("search-photos-lite-models"),a.getModelRegistry("photo-lite-models")]):p.concat([a.getModelRegistry("search-photos-models"),a.getModelRegistry("photo-models"),a.getModelRegistry("person-models"),a.getModelRegistry("photo-engagement-models"),a.getModelRegistry("photo-stats-models"),a.getModelRegistry("photo-geo-models")]),e.Promise.all(p).then((function(e){return i._processResponse(e,s)}),e.FetcherErrorLogger(o))},_processParams:function(o,t){var r,s=e.merge(e.SearchHelper.UNIFIED_DEFAULT_PARAMS,{extras:e.APIHelper.request[o.getPhotoLiteModels?"getRebootPhotoLiteExtras":"getRebootPhotoExtras"](),per_page:o.perPage||50,page:o.page||"1",lang:o.lang});return o.fetchGeo&&(s.extras+=",geo"),o.additionalExtras&&(s.extras+=","+o.additionalExtras.join(",")),r=e.merge(s,o.apiParams||{}),o.privacyFilter&&(r.privacy_filter=o.privacyFilter),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),e.SearchHelper.isParameterlessSearch(r)?null:r},_processResponse:function(o,t){var r,s,a,p,i,l,n=o[0],h=o[1],d=o[2],g={id:t.id||e.SearchUrl.EMPTY_SEARCH_ID,apiParams:{},emptyQuery:!!t.emptyQuery,photos:[]};if(t.id&&t.id!==e.SearchUrl.EMPTY_SEARCH_ID&&(g.apiParams=e.QueryString.parse(t.id)),!t.id)throw new ReferenceError("No `id` provided by request.");if(!(t.useV2API||n.photos&&n.photos.photo)){var c=new Error("No `photos.photo` property returned by search API v1.");throw c.fatal=!0,c}var u=t.useV2API?n.body:n.photos.photo;return t.getPhotoLiteModels?a=u.map((function(o){return i=e.APIHelper.response.parsePhotoLite(o),d.addOrUpdate(i)})):(a=e.APIHelper.response.parsePhotos({photos:n.photos.photo,photoModelRegistry:d,personModelRegistry:o[3],photoEngagementModelRegistry:o[4],photoStatsModelRegistry:o[5]}),t.fetchGeo&&(r=o[6],n.photos.photo.forEach((function(e){p=void 0!==e.latitude?{id:e.id,hasGeo:!0,latitude:e.latitude,longitude:e.longitude}:{id:e.id,hasGeo:!1},r.addOrUpdate(p)})))),g.photos={perPage:t.useV2API?t.perPage:n.photos.perpage,page:t.useV2API?t.page:n.photos.page,pageContent:a,totalItems:t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),totalPages:t.useV2API?parseInt(n.headers["x-total-count"]/t.perPage,10):n.photos.pages/t.perPage},!t.useV2API&&n.photos.maxAllowedResults&&(g.photos.totalItems=Math.min(n.photos.maxAllowedResults,parseInt(n.photos.total,10))),!t.useV2API&&n.photos.maxAllowedPages&&(g.photos.totalPages=Math.min(n.photos.maxAllowedPages,n.photos.pages)),g.totalItems=t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),h.exists(g.id)?(s=h.getValue(g.id,"photos").getList(),l=s.filter((function(e){return!!e})).reduce((function(e,o){return e[o.id]=!0,e}),{}),g.photos.pageContent=g.photos.pageContent.filter((function(e){return!l[e.id]})),1===g.photos.page&&(g.photos.forceAppend=!0),h.addOrUpdate(g)):h.add(g),a}}}),"@VERSION@",{requires:["flickr-promise","search-helper","search-url","api-helper","querystring-parse-simple"],optional:["search-photos-models","search-photos-lite-models","photo-models","photo-lite-models","person-models","photo-engagement-models","photo-stats-models","photo-geo-models"],optionalRequires:["superagent"]});YUI.add("search-photos-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher"]});YUI.add("photo-selector-limited-rows-photolist-view",(function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return t.photolistViewClasses&&(t.additionalViewClasses=t.photolistViewClasses),t.photoListConfig=e.merge(t.primaryPhotoListConfig),this.searchUrl=t.searchUrl,this.listId=t.listId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){return this.appContext.getModel("search-photos-lite-models",this.searchUrl.getId(),{}).then(function(e){this.searchModel=e,e.getValue("totalItems")<=0&&this.set("emptySearch",!0)}.bind(this))},buildContainer:function(){var e="search.YOUR_PHOTOS";return"contacts"===this.listId?e="search.FROM_YOUR_CONTACTS":"everyone"===this.listId&&(e="search.EVERYONES_PHOTOS"),this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.get("emptySearch"),total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:"#"+this.listId,"photo-list-view":this.subviews["photo-list-view"].get("container"),title:this.intlMessage({intlName:e})}),this},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick.bind(this))),this},handleClick:function(e){e.halt();var t,i=e.target;i.hasClass("view-more-link")&&(t=i.getDOMNode().href.split("#")[1],this.fire("subviewViewEvent","viewEntireSearchList",{list:t,searchUrl:this.searchUrl}))}},{ATTRS:{emptySearch:{value:!1}}})}),"@VERSION@",{requires:["flickr-view","photo-list-view","hermes-template-search-photos-single-row","search-photos-lite-models"],langBundles:["common","search"]});YUI.add("hermes-template-photo-selector-photo-list-photo-interaction",(function(e,l){var t=e.Template.Handlebars.revive({1:function(e,l,t,n,a){var o,r=e.escapeExpression,i=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<a href="'+r(e.lambda(null!=(o=null!=(o=null!=l?i(l,"photo"):l)?i(o,"owner"):o)?i(o,"url"):o,l))+'" class="attribution">'+r((i(t,"intlMessage")||l&&i(l,"intlMessage")||e.hooks.helperMissing).call(null!=l?l:e.nullContext||{},{name:"intlMessage",hash:{user:null!=(o=null!=(o=null!=l?i(l,"photo"):l)?i(o,"owner"):o)?i(o,"displayname"):o,intlName:"common.BY_USER"},data:a,loc:{start:{line:7,column:84},end:{line:7,column:154}}}))+"</a>"},compiler:[8,">= 4.3.0"],main:function(e,l,t,n,a){var o,r,i=null!=l?l:e.nullContext||{},s=e.escapeExpression,p=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<div class="photo-list-photo-interaction">\n\t<div class="square"></div>\n\t<div class="interaction-bar">\n\t\t<div class="text">\n\t\t\t<a href="'+s("function"==typeof(r=null!=(r=p(t,"photoPageUrl")||(null!=l?p(l,"photoPageUrl"):l))?r:e.hooks.helperMissing)?r.call(i,{name:"photoPageUrl",hash:{},data:a,loc:{start:{line:6,column:12},end:{line:6,column:28}}}):r)+'" class="title">'+s(e.lambda(null!=(o=null!=l?p(l,"photo"):l)?p(o,"title"):o,l))+"</a>\n\t\t\t"+(null!=(o=p(t,"if").call(i,null!=(o=null!=(o=null!=l?p(l,"photo"):l)?p(o,"owner"):o)?p(o,"displayname"):o,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:3},end:{line:7,column:165}}}))?o:"")+'\n\t\t</div>\n\t</div>\n</div>\n<div class="disabled-overlay"></div>\n'},useData:!0}),n={};e.Array.each([],(function(l){var t=e.Template.get("hermes/"+l);t&&(n[l]=t)})),e.Template.register("hermes/photo-selector-photo-list-photo-interaction",(function(l,a){return(a=a||{}).partials=a.partials?e.merge(n,a.partials):n,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});